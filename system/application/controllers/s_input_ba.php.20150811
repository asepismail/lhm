<?php
class s_input_ba extends Controller{
    private $data;
    function __construct(){
        parent::__construct();
        $this->load->model('model_s_input_ba');
        $this->load->model('model_c_user_auth');  
				
		$this->load->helper('url');
        $this->load->helper('object2array');
		
        $this->load->library('form_validation');
        $this->load->library('global_func');
        $this->load->library('session');
        $this->load->plugin('to_excel');
		
		require_once(APPPATH . 'libraries/fpdf_table.php');
        require_once(APPPATH . 'libraries/header_footer.inc');
        require_once(APPPATH . 'libraries/table_def.inc');
        $this->lastmenu="s_input_ba";
        $this->data = array();    
    }
    
    function index(){
        $view="info_s_input_ba";
		
        $this->data['judul_header'] = "Berita Acara Produksi Harian";
        $this->data['js'] = "";
    
        $this->data['login_id'] = htmlentities($this->session->userdata('LOGINID'),ENT_QUOTES,'UTF-8');
        $this->data['company_name'] = htmlentities($this->session->userdata('NCOMPANY_NAME'),ENT_QUOTES,'UTF-8');
        $this->data['company_code'] = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');
        $this->data['company_dest'] = htmlentities($this->session->userdata('DCOMPANY_NAME'),ENT_QUOTES,'UTF-8');
        $this->data['user_level'] = htmlentities($this->session->userdata('USER_LEVEL'),ENT_QUOTES,'UTF-8');
        $this->data['periode'] = $this->global_func->drop_date2('bulan','tahun','select');
        
        $this->data['menu']=$this->model_c_user_auth->get_menu($this->data['login_id'],$this->data['user_level'],$this->data['company_code'],$this->lastmenu); 
        
        if ($this->data['login_id'] == TRUE){
            show($view, $this->data);
        } else {
            redirect('login');
        }
    }
	
    function cek_tgl($tgl1){
		$tgl2=$today = date('Y-m-d');
		
		$pecah1 = explode("-", $tgl1);
		$date1 = $pecah1[2];
		$month1 = $pecah1[1];
		$year1 = $pecah1[0];
		
		$pecah2 = explode("-", $tgl2);
		$date2 = $pecah2[2];
		$month2 = $pecah2[1];
		$year2 =  $pecah2[0];
		
		$jd1 = GregorianToJD($month1, $date1, $year1);
		$jd2 = GregorianToJD($month2, $date2, $year2);		

		$selisih = $jd2 - $jd1;	
		return $selisih;
	}
	
    function CRUD_METHOD(){
        $loginid=trim(htmlentities($this->session->userdata('LOGINID'),ENT_QUOTES,'UTF-8'));
        $data = json_decode($this->input->post('myJson'), true);
        $data_id=array();
		$data_prod=array();
		$data_performance=array();
		$data_dispatch=array();
		$data_stock=array();
		$data_storage=array();
		$bolean_sta = false;
        $data_id = $data["id"];
		
		//asep
		/*
		$selisih = 0;
		$status = '';
		$error=false;
		$selisih=$this->cek_tgl(strtoupper(trim(htmlentities($data_id['BA_DATE'],ENT_QUOTES,'UTF-8'))));
		if($selisih >=3){
            $status  ="Maaf data BA tidak dapat disimpan, dikarenakan data terlambat diinput ".$selisih." Hari. Batas keterlambatan penginputan data adalah 2 (dua) hari. Silakan hubungi Administrator";
            $error=true;
        }
*/

		if(empty($status) && $error==false){ 
			if (strtoupper(trim(htmlentities($data_id['CRUD'],ENT_QUOTES,'UTF-8'))) == "DEL" || strtoupper(trim(htmlentities($data_id['CRUD'],ENT_QUOTES,'UTF-8'))) == "APPROVE"){
				$bolean_sta = true;	
			}else{
				$bolean_sta = false;		
			}
			
			if($bolean_sta==false){
				$data_prod = $data["prod"]; 
				$data_performance = $data["performance"];
				$data_dispatch = $data["dispatch"];
				$data_stock = $data["stock"];
				$data_storage = $data["storage"];
			}
			
			if(strtoupper(trim(htmlentities($data_id['CRUD'],ENT_QUOTES,'UTF-8'))) == "ADD"){
				$is_auth_user_command = $this->global_func->cek_user_authentification(htmlentities($this->session->userdata('USER_LEVEL'),ENT_QUOTES,'UTF-8'),"ADD",$loginid);
				
				if($is_auth_user_command['0']['ROLE_ADD']=='1'){
					$this->add_new($data_id, $data_prod, $data_dispatch, $data_stock, $data_storage, $data_performance);  
				}else{
					$return['status'] ="User tidak berwenang !!";
					$return['error']=true;
					echo json_encode($return);    
				}
				   
			}elseif(strtoupper(trim(htmlentities($data_id['CRUD'],ENT_QUOTES,'UTF-8'))) == "EDIT"){
				$is_auth_user_command = $this->global_func->cek_user_authentification(htmlentities($this->session->userdata('USER_LEVEL'),ENT_QUOTES,'UTF-8'),"EDIT",$loginid);
				if($is_auth_user_command['0']['ROLE_EDIT']=='1'){
					$this->update_data($data_id, $data_prod, $data_dispatch, $data_stock, $data_storage, $data_performance);    
				}else{
					$return['status'] ="User tidak berwenang!";
					$return['error']=true;
					echo json_encode($return);    
				}                    
			}elseif(strtoupper(trim(htmlentities($data_id['CRUD'],ENT_QUOTES,'UTF-8'))) == "DEL"){
				$is_auth_user_command = $this->global_func->cek_user_authentification(htmlentities($this->session->userdata('USER_LEVEL'),ENT_QUOTES,'UTF-8'),"DELETE",$loginid);
				if($is_auth_user_command['0']['ROLE_DELETE']=='1'){
					$this->delete_data($data_id);    
				}else{
					$return['status'] ="User tidak berwenang !!";
					$return['error']=true;
					echo json_encode($return);    
				}               
			}elseif(strtoupper(trim(htmlentities($data_id['CRUD'],ENT_QUOTES,'UTF-8'))) == "APPROVE"){
					$this->approve_data($data_id);                       
			}else{
				$return['status'] ="Operation Unknown!";
				$return['error']=true;
				echo json_encode($return);
			}    
		}else{ //else telat
			$return['status'] =$status;
			$return['error']=$error;
			echo json_encode($return);   	
		}//end telat
    }
	
	function pdf_daily($dates,$id){
		require_once(APPPATH . '/libraries/html2pdf/html2pdf.class.php');	
		ob_start();
		$content='';
		$company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');
		$company_name = htmlentities($this->session->userdata('DCOMPANY_NAME'),ENT_QUOTES,'UTF-8');

        $ar = preg_split('/[- :]/',trim($dates));
        $ar = implode('',$ar); //01062013
        
		$m='';
		$y='';
		$m=date("m",strtotime($ar));
		$y=date("Y",strtotime($ar));
		$first_month= $y.$m."01";
		$first_year= $y."01"."01";
		$yesterday=$dates-1;
		
		//start: Get data
		$total_ffb = 0;
		$actual=$this->model_s_input_ba->get_ffb_actual($company, $dates);
		//$actual_yesterday=$this->model_s_input_ba->get_ffb_actual($company, ($dates-1));
		$actual_first=$this->model_s_input_ba->get_ffb_min($company, $dates);
        $total_ffb =$actual->FFB_INTI+$actual->FFB_PLASMA+$actual->FFB_SUPPLIER+$actual->FFB_GROUP;
		
		$actual_cpo_prod=$this->model_s_input_ba->get_production($id, $company, 'CPO');
		$actual_cpo_prod_yesterday=$this->model_s_input_ba->get_production_yesterday(($dates-1), $company, 'CPO');
		$actual_kernel_prod=$this->model_s_input_ba->get_production($id, $company, 'KRN');
		$actual_shell_prod=$this->model_s_input_ba->get_production($id, $company, 'CKG');
		$actual_empty_bunch_prod=$this->model_s_input_ba->get_production($id, $company, 'TNK');
		$actual_abu_prod=$this->model_s_input_ba->get_production($id, $company, 'ABJ');
		$abu_prod_weight=0;
		if ($actual_abu_prod<>NULL){
			$abu_prod_weight=$actual_abu_prod->WEIGHT;
		}
		//$actual_solid_prod=$this->model_s_input_ba->get_production($id, $company, 'SLD');
		$empty_bunch_weight=0;
		if($actual->FFB_PROCESSED==0){
			$oil_er=0;
			$kernel_er=0;
			$shell_er=0;
			$empty_bunch_er=0;
			$abu_er=0;
			//$solid_er=0;
		}else{
			if ($actual_cpo_prod==NULL){
				$oil_er=0;
			}else{
				$oil_er=$actual_cpo_prod->WEIGHT/$actual->FFB_PROCESSED;
			}
			if ($actual_kernel_prod==NULL){
				$kernel_er=0;	
			}else{
				$kernel_er=$actual_kernel_prod->WEIGHT/$actual->FFB_PROCESSED;
			}
			if ($actual_shell_prod==NULL){
				$shell_er=0;
			}else{
				$shell_er=$actual_shell_prod->WEIGHT/$actual->FFB_PROCESSED;
			}
			if ($actual_empty_bunch_prod==NULL){
				$empty_bunch_er=0;				
			}else{
				$empty_bunch_er=$actual_empty_bunch_prod->WEIGHT/$actual->FFB_PROCESSED;
				$empty_bunch_weight=$actual_empty_bunch_prod->WEIGHT;
			}
			if ($actual_abu_prod==NULL){
				$abu_er=0;
			}else{
				$abu_er=$actual_abu_prod->WEIGHT/$actual->FFB_PROCESSED;
			}
		}
				
		$actual_cpo_despatch=$this->model_s_input_ba->get_despatch($id, $company, 'CPO');
		$actual_cpo_recycledespatch=$this->model_s_input_ba->get_recycle_despatch($dates, $company, 'CPO');
		$actual_kernel_despatch=$this->model_s_input_ba->get_despatch($id, $company, 'KRN');
		$actual_shell_despatch=$this->model_s_input_ba->get_despatch($id, $company, 'CKG');
		$actual_empty_bunch_despatch=$this->model_s_input_ba->get_despatch($id, $company, 'TNK');
		$actual_abu_despatch=$this->model_s_input_ba->get_despatch($id, $company, 'ABJ');
		
		$empty_bunch_despatch_weight=0;
		if ($actual_empty_bunch_despatch<>NULL){
			$empty_bunch_despatch_weight=$actual_empty_bunch_despatch->WEIGHT;	
		}
		$abu_despatch_weight=0;
		if ($actual_abu_despatch<>NULL){
			$abu_despatch_weight=$actual_abu_despatch->WEIGHT;
		}
		
		$actual_cpo_stock=$this->model_s_input_ba->get_stock($id, $company, 'CPO');
		$actual_kernel_stock=$this->model_s_input_ba->get_stock($id, $company, 'KRN');
		$actual_shell_stock=$this->model_s_input_ba->get_stock($id, $company, 'CKG');
		$actual_empty_bunch_stock=$this->model_s_input_ba->get_stock($id, $company, 'TNK');
		$actual_abu_stock=$this->model_s_input_ba->get_stock($id, $company, 'ABJ');
		//$actual_solid_stock=$this->model_s_input_ba->get_stock($id, $company, 'SLD');	
		$empty_bunch_stock_weight=0;
		if ($actual_empty_bunch_stock<>NULL){
			$empty_bunch_stock_weight=$actual_empty_bunch_stock->WEIGHT;
		}
		$abu_stock_weight=0;
		if ($actual_abu_stock<>NULL){
			$abu_stock_weight=$actual_abu_stock->WEIGHT;
		}
				
		$actual_cpo_stock1=$this->model_s_input_ba->get_storage_stock($id, $company, 'CPO', 1);
		if ($actual_cpo_stock1==NULL){
			$weight_cpo1=0;
			$ffa_cpo1=0;
			$dirt_cpo1=0;
			$moisture_cpo1=0;
			$write_off1=0;
			$oil_recovery1=0;
		}else{
			$weight_cpo1=$actual_cpo_stock1->WEIGHT;
			$ffa_cpo1=$actual_cpo_stock1->FFA;
			$dirt_cpo1=$actual_cpo_stock1->DIRT;
			$moisture_cpo1=$actual_cpo_stock1->MOISTURE;
			$write_off1=$actual_cpo_stock1->WRITE_OFF;
			$oil_recovery1=$actual_cpo_stock1->OIL_RECOVERY;
		}
		
		/*
		$check_ffa_month=$this->model_s_input_ba->check_ffa($first_month, $dates, $company, 'CPO'); 
		if ($check_ffa_month==true){
			$ffa_month = $actual_cpo_prod->FFA;	
		}else{
			$ffa_month = (($actual_cpo_prod->WEIGHT*$actual_cpo_prod->FFA)+($actual_cpo_prod_yesterday->WEIGHT*$actual_cpo_prod_yesterday->FFA))/($actual_cpo_prod->WEIGHT+$actual_cpo_prod_yesterday->WEIGHT);
		}
		$check_ffa_month_yesterday=$this->model_s_input_ba->check_ffa($first_month, $dates-1, $company, 'CPO'); 
		if ($check_ffa_month_yesterday==true){
			$ffa_month_yesterday = $actual_cpo_prod_yesterday->FFA;	
		}else{
			$ffa_month_yesterday = (($actual_cpo_prod_yesterday->WEIGHT*$actual_cpo_prod_yesterday->FFA)+($actual_cpo_prod_yesterday->WEIGHT*$actual_cpo_prod_yesterday->FFA))/($actual_cpo_prod->WEIGHT+$actual_cpo_prod_yesterday->WEIGHT);
		}
		*/

		$row_ffa_month=$this->model_s_input_ba->get_ffa_period($first_month, $dates, $company, 'CPO'); //month
		$ffa_month = 0;
		$weight_month = 0;
		
		$ffa_cpo = 0;
		$weight_cpo = 0;
		foreach($row_ffa_month as $row){
			if ($row['FLAG']=='1'){
				$ffa_month = $row['FFA']; 
				$weight_month = $row['WEIGHT'];				
			}else{
				if ($weight_month==0){
					$ffa_cpo =0;
				}else{
					$ffa_cpo = (($row['FFA']*$row['WEIGHT'])+($ffa_month*$weight_month))/($weight_month+$row['WEIGHT']);
				}
				$weight_cpo = ($weight_month+$row['WEIGHT']);
				$ffa_month = $ffa_cpo;
				$weight_month = $weight_cpo; 
			}
			
		}
		//$ffa_cpo_month  = 0;
		//$i_ffa = 0;
		/*
		//masih error
		if ($row_ffa_month!=NULL){
			foreach($row_ffa_month as $row){				
				$ffa_month = $ffa_month + $row['FFA'];
				
				if ($row['FFA']=='0' || $row['FFA']=='0.00'){
					$i_ffa = $i_ffa + 1;
				}	
						
			}
			if ($i_ffa==0){
				$ffa_cpo_month = 0;
			}else{
				$ffa_cpo_month = $ffa_month /$i_ffa;
			}
		}
		//masih error
		*/
		$actual_cpo_stock2=$this->model_s_input_ba->get_storage_stock($id, $company, 'CPO', 2);	
		if ($actual_cpo_stock2==NULL){
			$weight_cpo2=0;
			$ffa_cpo2=0;
			$dirt_cpo2=0;
			$moisture_cpo2=0;
			$write_off2=0;
			$oil_recovery2=0;
		}else{
			$weight_cpo2=$actual_cpo_stock2->WEIGHT;
			$ffa_cpo2=$actual_cpo_stock2->FFA;
			$dirt_cpo2=$actual_cpo_stock2->DIRT;
			$moisture_cpo2=$actual_cpo_stock2->MOISTURE;
			$write_off2=$actual_cpo_stock2->WRITE_OFF;
			$oil_recovery2=$actual_cpo_stock2->OIL_RECOVERY;
		}
		$sum_weight_cpo=$weight_cpo1+$weight_cpo2;
		if($sum_weight_cpo==0){
			$ffa_stock_cpo=0;
		}else{
			$ffa_stock_cpo=(($weight_cpo1*$ffa_cpo1)+($weight_cpo2*$ffa_cpo2))/($sum_weight_cpo);	
		}
		$actual_sounding_cpo1=$this->model_s_input_ba->get_sounding_cpo($dates, $company, 'CPO', 1);
		if ($actual_sounding_cpo1==NULL){
			$sounding_cpo1=0;
			$sounding_temp_cpo1=0;
		}else{			
			$sounding_cpo1=$actual_sounding_cpo1->HEIGHT;
			$sounding_temp_cpo1=$actual_sounding_cpo1->TEMPERATURE;
		}
		$actual_sounding_cpo2=$this->model_s_input_ba->get_sounding_cpo($dates, $company, 'CPO', 2);
		if ($actual_sounding_cpo2==NULL){
			$sounding_cpo2=0;
			$sounding_temp_cpo2=0;
		}else{			
			$sounding_cpo2=$actual_sounding_cpo2->HEIGHT;
			$sounding_temp_cpo2=$actual_sounding_cpo2->TEMPERATURE;
		}
		$actual_kernel_stock1=$this->model_s_input_ba->get_storage_stock($id, $company, 'KERNEL', 1);
		if ($actual_kernel_stock1==NULL){
			$weight_kernel1= 0;
			$ffa_kernel1=0;
			$dirt_kernel1=0;
			$moisture_kernel1=0;
		}else{
			$weight_kernel1=$actual_kernel_stock1->WEIGHT;
			$ffa_kernel1=$actual_kernel_stock1->FFA;
			$dirt_kernel1=$actual_kernel_stock1->DIRT;
			$moisture_kernel1=$actual_kernel_stock1->MOISTURE;
		}
		$actual_kernel_stock2=$this->model_s_input_ba->get_storage_stock($id, $company, 'KERNEL', 2);
		if ($actual_kernel_stock2==NULL){
			$weight_kernel2= 0;
			$ffa_kernel2=0;
			$dirt_kernel2=0;
			$moisture_kernel2=0;
		}else{
			$weight_kernel2= $actual_kernel_stock2->WEIGHT;
			$ffa_kernel2=$actual_kernel_stock2->FFA;
			$dirt_kernel2=$actual_kernel_stock2->DIRT;
			$moisture_kernel2=$actual_kernel_stock2->MOISTURE;
		}
		$actual_sounding_kernel1=$this->model_s_input_ba->get_sounding_kernel($dates, $company, 'KERNEL', 1);
		if ($actual_sounding_kernel1==NULL){
			$sounding_kernel1=0;
		}else{
			$sounding_kernel1=$actual_sounding_kernel1->HEIGHT;
			if ($sounding_kernel1==0){
				$sounding_kernel1=$actual_sounding_kernel1->HEIGHT2;	
			}
		}
		$actual_sounding_kernel2=$this->model_s_input_ba->get_sounding_kernel($dates, $company, 'KERNEL', 2);
		if ($actual_sounding_kernel2==NULL){
			$sounding_kernel2=0;
		}else{
			$sounding_kernel2=$actual_sounding_kernel2->HEIGHT;
			if ($sounding_kernel2==0){
				$sounding_kernel2=$actual_sounding_kernel2->HEIGHT2;	
			}
		}
		$ffb_month_todate=$this->model_s_input_ba->get_ffb_period($first_month, $dates, $company);
		$ffb_month_todate_yesterday=$this->model_s_input_ba->get_ffb_period($first_month, $dates-1, $company); //yesterday
		$ffb_year_todate=$this->model_s_input_ba->get_ffb_period($first_year, $dates, $company);
		if($actual->PROCESSED_HOUR==0){
			$actual_troughput=0;			
		}else{
			$actual_troughput=$actual->FFB_PROCESSED/$actual->PROCESSED_HOUR/1000;	
		}
		if($ffb_month_todate->PROCESSED_HOUR==0){
			$month_troughput=0;			
		}else{
			$month_troughput=$ffb_month_todate->FFB_PROCESSED/$ffb_month_todate->PROCESSED_HOUR/1000;	
		}
		if($ffb_year_todate->PROCESSED_HOUR==0){
			$year_troughput=0;			
		}else{
			$year_troughput=$ffb_year_todate->FFB_PROCESSED/$ffb_year_todate->PROCESSED_HOUR/1000;
		}
		
		$total_month_ffb =$ffb_month_todate->FFB_INTI+$ffb_month_todate->FFB_PLASMA+$ffb_month_todate->FFB_SUPPLIER+$ffb_month_todate->FFB_GROUP;
		$total_month_ffb_yesterday =$ffb_month_todate_yesterday->FFB_INTI+$ffb_month_todate_yesterday->FFB_PLASMA+$ffb_month_todate_yesterday->FFB_SUPPLIER+$ffb_month_todate_yesterday->FFB_GROUP; //yesterday
		
		$total_year_ffb =$ffb_year_todate->FFB_INTI+$ffb_year_todate->FFB_PLASMA+$ffb_year_todate->FFB_SUPPLIER+$ffb_year_todate->FFB_GROUP;
		$month_cpo_prod =$this->model_s_input_ba->get_prod_period($first_month, $dates, $company, 'CPO');
		$month_cpo_prod_yesterday =$this->model_s_input_ba->get_prod_period($first_month, $dates, $company, 'CPO');
		$year_cpo_prod =$this->model_s_input_ba->get_prod_period($first_year, $dates, $company, 'CPO');
		$month_kernel_prod =$this->model_s_input_ba->get_prod_period($first_month, $dates, $company, 'KRN');
		$year_kernel_prod =$this->model_s_input_ba->get_prod_period($first_year, $dates, $company, 'KRN');
		$month_shell_prod =$this->model_s_input_ba->get_prod_period($first_month, $dates, $company, 'CKG');
		$year_shell_prod =$this->model_s_input_ba->get_prod_period($first_year, $dates, $company, 'CKG');
		$month_empty_bunch_prod =$this->model_s_input_ba->get_prod_period($first_month, $dates, $company, 'TNK');
		$year_empty_bunch_prod =$this->model_s_input_ba->get_prod_period($first_year, $dates, $company, 'TNK');
		$month_abu_prod =$this->model_s_input_ba->get_prod_period($first_month, $dates, $company, 'ABJ');
		$year_abu_prod =$this->model_s_input_ba->get_prod_period($first_year, $dates, $company, 'ABJ');
		//$month_solid_prod =$this->model_s_input_ba->get_prod_period($first_month, $dates, $company, 'SLD');
		//$year_solid_prod =$this->model_s_input_ba->get_prod_period($first_year, $dates, $company, 'SLD');
		
		$month_cpo_dispatch =$this->model_s_input_ba->get_dispatch_period($first_month, $dates, $company, 'CPO');
		$year_cpo_dispatch =$this->model_s_input_ba->get_dispatch_period($first_year, $dates, $company, 'CPO');
		$month_kernel_dispatch =$this->model_s_input_ba->get_dispatch_period($first_month, $dates, $company, 'KRN');
		$year_kernel_dispatch =$this->model_s_input_ba->get_dispatch_period($first_year, $dates, $company, 'KRN');
		$month_shell_dispatch =$this->model_s_input_ba->get_dispatch_period($first_month, $dates, $company, 'CKG');
		$year_shell_dispatch =$this->model_s_input_ba->get_dispatch_period($first_year, $dates, $company, 'CKG');
		$month_empty_bunch_dispatch =$this->model_s_input_ba->get_dispatch_period($first_month, $dates, $company, 'TNK');
		$year_empty_bunch_dispatch =$this->model_s_input_ba->get_dispatch_period($first_year, $dates, $company, 'TNK');
		$month_abu_dispatch =$this->model_s_input_ba->get_dispatch_period($first_month, $dates, $company, 'ABJ');
		$year_abu_dispatch =$this->model_s_input_ba->get_dispatch_period($first_year, $dates, $company, 'ABJ');
				
		$qc=$actual->QC;
		$mill_manager=$actual->MILL_MANAGER;
		$ktu=$actual->KTU;
		$administratur=$actual->ADMINISTRATUR;
		$labor=$actual->LABOR;
		
		$dispatch_doc = $this->model_s_input_ba->get_dispatch_doc($dates,$company);
		//end: Get data
		
		$content = "
		<style> .tbl_header { font-size: 12px; border-top:1px solid;border-left:1px solid} 
.tbl_th { font-size: 12px; border-bottom:1px solid; border-right:1px solid} 
.tbl_th8 { font-size: 9px; border-bottom:1px solid; border-right:1px solid} 
.tbl_th7 { font-size: 12px; border-bottom:1px solid; border-right:1px solid; padding: 0 15px} 
.tbl_th2 { font-size: 12px; font-weight:bold; border-bottom:1px solid; border-right:1px solid; background-color:#CCC} 
.tbl_th3 { font-size: 12px; font-weight:bold; border-bottom:1px solid} 
.tbl_th4 { font-size: 12px; font-weight:bold; border-right:1px solid} 
.tbl_th5 { font-size: 12px; border-right:1px solid} 
.tbl_th6 { font-size: 10px; border-right:1px solid} 
.tbl_header2 { font-size: 18px; border-bottom:2px solid; border-right:1px solid} 
.tbl_header3 { font-size: 10px; border-bottom:2px solid} 
.tbl_header4 { font-size: 12px; border-bottom:2px solid; border-right:1px solid} 
.tbl_td { font-size: 12px; border-bottom:1px solid; border-right:1px solid} 
.tbl_td3 {font-size: 12px; text-decoration:underline} 
.tbl_td2 {border-right:1px solid} 
.tbl_2 { font-size: 12px;color:#678197;} 
.content { font-size: 12px;color:#678197; } .content2 { font-size: 11px;color:#678197; } </style>
<table width='100%' class='tbl_header' cellpadding='0' cellspacing='0'>
<tr>    
    <td colspan='2' align='center' class='tbl_header4' height='20'>PT. ".$company_name." </td>
    <td colspan='4' align='center' class='tbl_header2' height='20'>DAILY PRODUCTION REPORT</td>
    <td colspan='2' align='center' class='tbl_header4' height='20'>TANGGAL: " .date("d-m-Y",strtotime($dates))." </td>
  </tr>
  <tr>
    <td class='tbl_th2'>&nbsp;</td>
    <td class='tbl_th2' colspan='2' align='center'>For Day</td>
    <td class='tbl_th2' colspan='3' align='center'>Month Todate</td>
    <td class='tbl_th2' colspan='2' align='center'>Year Todate</td>
  </tr>
  <tr>
    <td class='tbl_th2' align='center' width='80'>FFB</td>
    <td class='tbl_th2' align='center' width='80'>Actual Received (Kg)</td>
    <td class='tbl_th2' align='center' width='80'>Budget Received (Kg)</td>
    <td class='tbl_th2' align='center' width='80'>Actual Received (Kg)</td>
    <td class='tbl_th2' align='center' width='85'>To date Budget Received (Kg)</td>
    <td class='tbl_th2' align='center' width='80'>Month Budget Received (Kg)</td>
    <td class='tbl_th2' align='center' width='80'>Actual YTD Received (Kg)</td>
    <td class='tbl_th2' align='center' width='80'>Budget YTD Received (Kg)</td>
  </tr>";
  $content .= "<tr><td class='tbl_th'>&nbsp;"." Inti"."</td><td class='tbl_th' align='right'>".number_format($actual->FFB_INTI,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format($ffb_month_todate->FFB_INTI,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format($ffb_year_todate->FFB_INTI,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th'>&nbsp;"." Plasma"."</td><td class='tbl_th' align='right'>".number_format($actual->FFB_PLASMA,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format($ffb_month_todate->FFB_PLASMA,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format($ffb_year_todate->FFB_PLASMA,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th'>&nbsp;"." Outside supplier"."</td><td class='tbl_th' align='right'>".number_format($actual->FFB_SUPPLIER,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format($ffb_month_todate->FFB_SUPPLIER,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format($ffb_year_todate->FFB_SUPPLIER,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th'>&nbsp;"." Group"."</td><td class='tbl_th' align='right'>".number_format($actual->FFB_GROUP,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format($ffb_month_todate->FFB_GROUP,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format($ffb_year_todate->FFB_GROUP,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th7'>&nbsp;"."Total FFB Received"."</td><td class='tbl_th' align='right'>".number_format($total_ffb,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format($total_month_ffb,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format($total_year_ffb,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th'>&nbsp;"." Balance Yesterday"."</td><td class='tbl_th' align='right'>".number_format($actual->BALANCE_YESTERDAY,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td></tr>";

  if ($actual_first==NULL){
  	$actual_first->BALANCE_YESTERDAY = 0;
  }
  $content .= "<tr><td class='tbl_th7'>&nbsp;"." Total FFB"."</td><td class='tbl_th' align='right'>".number_format($total_ffb+$actual->BALANCE_YESTERDAY,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format($total_month_ffb+$actual_first->BALANCE_YESTERDAY,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th7'>&nbsp;"." Total FFB Processed"."</td><td class='tbl_th' align='right'>".number_format($actual->FFB_PROCESSED,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format($ffb_month_todate->FFB_PROCESSED,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format($ffb_year_todate->FFB_PROCESSED,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th'>&nbsp;"." Balance Today"."</td><td class='tbl_th' align='right'>".number_format($actual->BALANCE,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format(($total_month_ffb+$actual_first->BALANCE_YESTERDAY)-($ffb_month_todate->FFB_PROCESSED),2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th'>&nbsp;"." Average cage weight"."</td><td class='tbl_th' align='right'>".number_format($actual->CAGE_WEIGHT,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'></td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'></td><td class='tbl_th' align='right'>&nbsp;</td></tr>";
  $content .= "<tr><td colspan='8' class='tbl_th2' align='center'>&nbsp;"." PERFORMANCE"."</td></tr>";
  $content .= "<tr><td class='tbl_th'>&nbsp;"." Processed hour"."</td><td class='tbl_th' align='right'>".number_format($actual->PROCESSED_HOUR,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format($ffb_month_todate->PROCESSED_HOUR,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format($ffb_year_todate->PROCESSED_HOUR,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th'>&nbsp;"." Throughput"."</td><td class='tbl_th' align='right'>".number_format($actual_troughput,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format($month_troughput,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format($year_troughput,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td></tr>";
  $kj_month=$this->model_s_input_ba->get_kj_month($dates,$company); 
  if ($kj_month==0){
	$mill_month=0;  
  }else{
  	$mill_month=$ffb_month_todate->FFB_PROCESSED/(30000*20*$kj_month)*100;
  }
  $kj_year=$this->model_s_input_ba->get_kj_year($dates,$company); 
  if ($kj_year==0){
	$mill_year=0;  
  }else{
  	$mill_year=$ffb_year_todate->FFB_PROCESSED/(30000*20*$kj_year)*100;
  }
  $content .= "<tr><td class='tbl_th'>&nbsp;"." Mill Utilization"."</td><td class='tbl_th' align='right'>".number_format($actual->MILL_UTILIZATION,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format($mill_month,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>".number_format($mill_year,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td></tr>";
  $content .= "<tr><td colspan='8' class='tbl_th2' align='center'>&nbsp;"." PRODUCTION"."</td></tr>";
  $content .= "<tr><td align='right' class='tbl_th'> &nbsp;"." CPO"."</td><td align='right' class='tbl_th'>".number_format($actual_cpo_prod->WEIGHT,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($month_cpo_prod,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($year_cpo_prod,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th'>&nbsp;"." FFA"."</td><td align='right' class='tbl_th'>".number_format($actual_cpo_prod->FFA,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($ffa_month,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'></td><td align='right' class='tbl_th'>&nbsp;</td></tr>";
  if ($ffb_month_todate->FFB_PROCESSED==0){
  	$oil_er_month=0;
  }else{
	$oil_er_month=($month_cpo_prod/$ffb_month_todate->FFB_PROCESSED)*100;	  
  }
  if ($ffb_year_todate->FFB_PROCESSED==0){
  	$oil_er_year=0;
	$kernel_er_year=0;
	$shell_er_year=0;
	$abu_er_year=0;
	$empty_bunch_er_year=0;
  }else{
	$oil_er_year=($year_cpo_prod/$ffb_year_todate->FFB_PROCESSED)*100;	 
	$kernel_er_year=($year_kernel_prod/$ffb_year_todate->FFB_PROCESSED)*100;
	$shell_er_year=($year_shell_prod/$ffb_year_todate->FFB_PROCESSED)*100;
	$abu_er_year=($year_abu_prod/$ffb_year_todate->FFB_PROCESSED)*100;
	$empty_bunch_er_year=($year_empty_bunch_prod/$ffb_year_todate->FFB_PROCESSED)*100;
  }
  $content .= "<tr><td class='tbl_th'>&nbsp;"." Oil Extraction Rates"."</td><td align='right' class='tbl_th'>".number_format(($oil_er)*100,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($oil_er_month,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($oil_er_year,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td></tr>";
  $content .= "<tr><td align='right' class='tbl_th'> &nbsp;"." KERNEL"."</td><td align='right' class='tbl_th'>".number_format($actual_kernel_prod->WEIGHT,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($month_kernel_prod,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($year_kernel_prod,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td></tr>";

  if ($ffb_month_todate->FFB_PROCESSED==0.00){
	  $kernel_er_month=0;
	  $shell_er_month=0;
	  $abu_er_month=0;
	  $empty_bunch_er_month=0;
  }else{
	  $kernel_er_month=($month_kernel_prod/$ffb_month_todate->FFB_PROCESSED)*100;
	  $shell_er_month=($month_shell_prod/$ffb_month_todate->FFB_PROCESSED)*100;
	  $abu_er_month=($month_abu_prod/$ffb_month_todate->FFB_PROCESSED)*100;
	  $empty_bunch_er_month=($month_empty_bunch_prod/$ffb_month_todate->FFB_PROCESSED)*100;
  }
	  
  $content .= "<tr><td class='tbl_th'> &nbsp;"." Kernel Extraction Rates"."</td><td align='right' class='tbl_th'>".number_format(($kernel_er)*100,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($kernel_er_month,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($kernel_er_year,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td></tr>";
  $content .= "<tr><td align='right' class='tbl_th'> &nbsp;"." SHELL"."</td><td align='right' class='tbl_th'>".number_format($actual_shell_prod->WEIGHT,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($month_shell_prod,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($year_shell_prod,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td></tr>";	
  $content .= "<tr><td class='tbl_th'>%</td><td align='right' class='tbl_th'>".number_format(($shell_er)*100,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($shell_er_month,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($shell_er_year,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td></tr>";
  $content .= "<tr><td align='right' class='tbl_th'> &nbsp;"." EMPTY BUNCH"."</td><td align='right' class='tbl_th'>".number_format($empty_bunch_weight,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($month_empty_bunch_prod,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($year_empty_bunch_prod,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th'>%</td><td align='right' class='tbl_th'>".number_format(($empty_bunch_er)*100,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($empty_bunch_er_month,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($empty_bunch_er_year,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td></tr>";
  $content .= "<tr><td align='right' class='tbl_th'> &nbsp;"." ABU"."</td><td align='right' class='tbl_th'>".number_format($abu_prod_weight,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($month_abu_prod,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($year_abu_prod,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td></tr>";	
  $content .= "<tr><td class='tbl_th'>%</td><td align='right' class='tbl_th'>".number_format(($abu_er)*100,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($abu_er_month,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td><td align='right' class='tbl_th'>".number_format($abu_er_year,2)."&nbsp;</td><td align='right' class='tbl_th'>&nbsp;</td></tr>";
  $content .= "<tr><td colspan='5' class='tbl_th3'>&nbsp;</td><td colspan='3' class='tbl_th4'>&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th2' colspan='2'> &nbsp;"." PRODUCTION QUALITY"."</td><td class='tbl_th2' align='center'>FFA/BROKEN</td><td class='tbl_th2' align='center'>DIRTY</td><td class='tbl_th2' align='center'>MOISTURE</td><td class='tbl_th4' colspan='3' rowspan='3'></td></tr>";
  $content .= "<tr><td class='tbl_th' colspan='2'> &nbsp;"." CPO"."</td><td class='tbl_th' align='right'>".number_format($actual_cpo_prod->FFA,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($actual_cpo_prod->DIRT,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($actual_cpo_prod->MOISTURE,2)."&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th' colspan='2'> &nbsp;"." KERNEL"."</td><td class='tbl_th' align='right'>".number_format($actual_kernel_prod->FFA,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($actual_kernel_prod->DIRT,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($actual_kernel_prod->MOISTURE,2)."&nbsp;</td></tr>";
  $content .= "<tr><td colspan='8' class='tbl_td'>&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th2' colspan='5' align='center'> &nbsp;"." KRITERIA GRADING"."</td><td class='tbl_th2' align='center'>&nbsp;</td><td class='tbl_th2' align='center'>FROM</td><td class='tbl_th2' align='center'>TO</td></tr>";
  $content .= "<tr><td align='center' class='tbl_th2'> &nbsp;"." BUAH MENTAH"."</td><td align='center' class='tbl_th2'>BUAH BUSUK</td><td align='center' class='tbl_th2'>TANGKAI PJG</td><td align='center' class='tbl_th2'>JANJANG KSG</td><td align='center' class='tbl_th2'>BRONDOLAN</td><td align='right' class='tbl_th2'>PROCESS </td><td align='right' class='tbl_th8'>".$actual->HOUR_FROM."&nbsp;</td><td align='right' class='tbl_th8'>".$actual->HOUR_TO."&nbsp;</td></tr>";
  $content .= "<tr><td align='right' class='tbl_th'>".number_format($actual->BUAH_MENTAH,2)."&nbsp;</td><td align='right' class='tbl_th'>".number_format($actual->BUAH_BUSUK,2)."&nbsp;</td><td align='right' class='tbl_th'>".number_format($actual->TANGKAI,2)."&nbsp;</td><td align='right' class='tbl_th'>".number_format($actual->JJK,2)."&nbsp;</td><td align='right' class='tbl_th'>".number_format($actual->BRONDOLAN,2)."&nbsp;</td><td align='right' class='tbl_th2'>CBC HOUR </td><td align='right' class='tbl_th'>".number_format($actual->CBC_FROM,2)."&nbsp;</td><td align='right' class='tbl_th'>".number_format($actual->CBC_TO,2)."&nbsp;</td></tr>";
  $content .= "<tr><td colspan='7' class='tbl_th3'>&nbsp;</td><td class='tbl_th4'>&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th2'> &nbsp;"." DESPATCH"."</td><td class='tbl_th2' align='center'>FOR DAY</td><td class='tbl_th2' align='center'>FFA/BROKEN</td><td class='tbl_th2' align='center'>DIRTY</td><td class='tbl_th2' align='center'>MOISTURE</td><td class='tbl_th2' align='center'>MONTH TODATE</td><td class='tbl_th2' align='center'>YEAR TODATE</td><td class='tbl_th4' rowspan='6'></td></tr>";	
  $content .= "<tr><td class='tbl_th'> &nbsp;"." CPO"."</td><td class='tbl_th' align='right'>".number_format($actual_cpo_despatch->WEIGHT,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($actual_cpo_despatch->FFA,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($actual_cpo_despatch->DIRT,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($actual_cpo_despatch->MOISTURE,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($month_cpo_dispatch,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($year_cpo_dispatch,2)."&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th'> &nbsp;"." KERNEL"."</td><td class='tbl_th' align='right'>".number_format($actual_kernel_despatch->WEIGHT,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($actual_kernel_despatch->FFA,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($actual_kernel_despatch->DIRT,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($actual_kernel_despatch->MOISTURE,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($month_kernel_dispatch,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($year_kernel_dispatch,2)."&nbsp;</td></tr>"; 
  $content .= "<tr><td class='tbl_th'> &nbsp;"." SHELL"."</td><td class='tbl_th' align='right'>".number_format($actual_shell_despatch->WEIGHT,2)."&nbsp;</td><td class='tbl_th' align='right'></td><td class='tbl_th' align='right'></td><td class='tbl_th' align='right'></td><td class='tbl_th' align='right'>".number_format($month_shell_dispatch,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($year_shell_dispatch,2)."&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th'> &nbsp;"." EMPTY BUNCH"."</td><td class='tbl_th' align='right'>".number_format($empty_bunch_despatch_weight,2)."&nbsp;</td><td class='tbl_th' align='center'></td><td class='tbl_th' align='right'></td><td class='tbl_th' align='center'></td><td class='tbl_th' align='right'>".number_format($month_empty_bunch_dispatch,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($year_empty_bunch_dispatch,2)."&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th'> &nbsp;"." ABU"."</td><td class='tbl_th' align='right'>".number_format($abu_despatch_weight,2)."&nbsp;</td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td><td class='tbl_th' align='right'>".number_format($month_abu_dispatch,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($year_abu_dispatch,2)."&nbsp;</td></tr>";
  //asep
  if ($actual_cpo_recycledespatch != NULL){
	  //$content .= "<tr><td colspan='7' class='tbl_th3'>&nbsp;</td><td class='tbl_th4'>&nbsp;</td></tr>";
	  $content .= "<tr><td class='tbl_th2'> &nbsp;"." DESPATCH (RECYCLE) "."</td><td class='tbl_th2' align='center'>FOR DAY</td><td class='tbl_th2' align='center'>FFA/BROKEN</td><td class='tbl_th2' align='center'>DIRTY</td><td class='tbl_th2' align='center'>MOISTURE</td><td class='tbl_th4' colspan='3' rowspan='3'></td></tr>";
  	  $content .= "<tr><td class='tbl_th'> &nbsp;"." CPO"."</td><td class='tbl_th' align='right'>".number_format($actual_cpo_recycledespatch->BERAT_BERSIH,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($actual_cpo_recycledespatch->BROKEN,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($actual_cpo_recycledespatch->DIRTY,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($actual_cpo_recycledespatch->MOIST,2)."&nbsp;</td></tr>";
  }
  //asep
  $content .= "<tr><td colspan='7' class='tbl_th3'>&nbsp;</td><td class='tbl_th4'>&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th2'> &nbsp;"." STOCK"."</td><td class='tbl_th2' align='center'>FOR DAY</td><td class='tbl_th2' align='center'>FFA/BROKEN</td><td class='tbl_th2' align='center'>DIRTY</td><td class='tbl_th2' align='center'>MOISTURE</td><td class='tbl_th2' align='center'>SOUNDING (mm)</td><td class='tbl_th2' align='center'>TEMPERATURE</td><td class='tbl_th4' rowspan='10'>&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th'> &nbsp;"." CPO"."</td><td class='tbl_th' align='right'>".number_format($weight_cpo1+$weight_cpo2,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($ffa_stock_cpo,2)."&nbsp;</td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td></tr>";
  $content .= "<tr><td class='tbl_th'> &nbsp;"." STORAGE TANK 1"."</td><td class='tbl_th' align='right'>".number_format($weight_cpo1,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($ffa_cpo1,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($dirt_cpo1,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($moisture_cpo1,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($sounding_cpo1*1000)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($sounding_temp_cpo1)."&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th'> &nbsp;"." STORAGE TANK 2"."</td><td class='tbl_th' align='right'>".number_format($weight_cpo2,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($ffa_cpo2,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($dirt_cpo2,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($moisture_cpo2,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format(
$sounding_cpo2*1000)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($sounding_temp_cpo2)."&nbsp;</td></tr>";
  //asep
  $content .= "<tr><td class='tbl_th7'> &nbsp;"." WRITE OFF/ SLUDGE"."</td><td class='tbl_th' align='right'>".number_format($write_off2+$write_off1,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td></tr>";
  $content .= "<tr><td class='tbl_th7'> &nbsp;"." OIL RECOVERY"."</td><td class='tbl_th' align='right'>".number_format($oil_recovery2+$oil_recovery1,2)."&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td><td class='tbl_th' align='right'>&nbsp;</td></tr>";
  //asep
  $content .= "<tr><td class='tbl_th'> &nbsp;"." KERNEL"."</td><td class='tbl_th' align='right'>".number_format($weight_kernel1+$weight_kernel2,2)."&nbsp;</td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td></tr>";
  $content .= "<tr><td class='tbl_th'> &nbsp;"." BUNKER 1"."</td><td class='tbl_th' align='right'>".number_format($weight_kernel1,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($ffa_kernel1,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($dirt_kernel1,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($moisture_kernel1,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($sounding_kernel1*1000)."&nbsp;</td><td class='tbl_th' align='right'></td></tr>";
	$content .= "<tr><td class='tbl_th'> &nbsp;"." BUNKER 2"."</td><td class='tbl_th' align='right'>".number_format($weight_kernel2,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($ffa_kernel2,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($dirt_kernel2,2)."&nbsp;</td><td class='tbl_th' align='right'>".number_format($moisture_kernel2,2)."&nbsp;</td>&nbsp;<td class='tbl_th' align='right'>".number_format($sounding_kernel2*1000)."&nbsp;</td><td class='tbl_th' align='center'></td></tr>";
	$content .= "<tr><td class='tbl_th'> &nbsp;"." SHELL"."</td><td class='tbl_th' align='right'>".number_format($actual_shell_stock->WEIGHT,2)."&nbsp;</td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td></tr>";
	$content .= "<tr><td class='tbl_th'> &nbsp;"." EMPTY BUNCH"."</td><td class='tbl_th' align='right'>".number_format($empty_bunch_stock_weight,2)."&nbsp;</td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td></tr>";
	$content .= "<tr><td class='tbl_th'> &nbsp;"." ABU"."</td><td class='tbl_th' align='right'>".number_format($abu_stock_weight,2)."&nbsp;</td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td><td class='tbl_th' align='center'></td></tr>";
	$content .= "<tr><td colspan='6' class='tbl_th3'>&nbsp;</td><td class='tbl_th4' colspan='2' >&nbsp;</td></tr>";
	$content .= "<tr><td class='tbl_th2' align='center' colspan='2'>NO. DOC</td><td class='tbl_th2' align='center'>CONTRACT</td><td class='tbl_th2' align='center'>PARTY</td><td class='tbl_th2' align='center'>DISPATCH</td><td class='tbl_th2' align='center'>BALANCE</td><td class='tbl_th4' align='left' colspan='2'></td></tr>";
	//$content .= "<tr><td class='tbl_th2' align='center'>&nbsp;</td><td class='tbl_th2' align='center'>&nbsp;</td><td class='tbl_th2' align='center'>&nbsp;</td><td class='tbl_th2' align='center'>&nbsp;</td><td class='tbl_th2' align='center'>&nbsp;</td><td class='tbl_th4' align='left' colspan='3'>&nbsp;</td></tr>";
	foreach($dispatch_doc as $row){	
		$content.="<tr>";
        $content.="<td class='tbl_td' align='left' colspan='2'>"."&nbsp; ". $row['ID_DO']."</td>";		 
        $content.="<td class='tbl_td' align='right'>".$row['JENIS']."&nbsp;</td>";
        $content.="<td class='tbl_td' align='right'>".number_format($row['QTY_CONTRACT'],2)."&nbsp;</td>";
        $content.="<td class='tbl_td' align='right'>".number_format($row['QTY_DELIVERED_RUN'],2)."&nbsp;</td>";
        $content.="<td class='tbl_td' align='right'>".number_format($row['BALANCE'],2)."&nbsp;</td>";
		$content.="<td class='tbl_td2' colspan='2'></td>";
        $content.='</tr>';
    }
	if ($dispatch_doc==null){
		$content.="<tr>";
        $content.="<td class='tbl_td' align='center' colspan='2'>-</td>";		 
        $content.="<td class='tbl_td' align='center'>-</td>";
        $content.="<td class='tbl_td' align='center'>-</td>";
        $content.="<td class='tbl_td' align='center'>-</td>";
        $content.="<td class='tbl_td' align='center'>-</td>";
		$content.="<td class='tbl_td2' colspan='2'></td>";
        $content.='</tr>';	
	}
	//$content .= "<tr><td colspan='8' class='tbl_th4'>&nbsp;</td></tr>";

	$content .= "<tr><td class='tbl_th6' colspan='8'>&nbsp;"." NOTE : ".$actual->DESCRIPTION."</td></tr>";
	$content .= "<tr><td colspan='8' class='tbl_th6'>&nbsp;</td></tr>";
			

	$content.="<tr align='center'><td colspan='8' class='tbl_th5' ><table>
  <tr>
    <td colspan='2'>Prepared By,</td>
    <td colspan='2'>Checked By,</td>
    <td>Approved By,</td>
  </tr>
  <tr>
    <td height='35'>&nbsp;</td>
    <td height='35'>&nbsp;</td>
    <td height='35'>&nbsp;</td>
    <td height='35'>&nbsp;</td>
    <td height='35'>&nbsp;</td>
  </tr>
  <tr>
    <td class='tbl_td3'>".$qc."</td>
    <td class='tbl_td3'>".$labor."</td>
    <td class='tbl_td3'>".$mill_manager."</td>
    <td class='tbl_td3'>".$ktu."</td>
    <td class='tbl_td3'>".$administratur."</td>
  </tr>
  <tr>
    <td width='147'>Quality Control</td>
    <td width='147'>Ast. Labor</td>
    <td width='147'>Mill Manager</td>
    <td width='147'>KTU</td>
    <td width='147'>Administratur</td>
  </tr>
</table></td></tr>";

	$content .= "<tr><td colspan='8' class='tbl_th'>&nbsp;</td></tr>";
	$content.="</table>";
	//require_once(APPPATH . 'libraries/daftar_upah/authorize_ba2.inc');
		try{
			//ob_end_clean();
			$html2pdf = new HTML2PDF('P', 'Folio', 'en', true, 'UTF-8', array(4, 4, 4, 4));
			$html2pdf->pdf->SetDisplayMode('fullpage');
			$html2pdf->setDefaultFont('Arial');
			$html2pdf->writeHTML($content);
			$html2pdf->Output("BA_PRODUKSI_HARIAN_".$company."_".$dates.".pdf");
		}catch(HTML2PDF_exception $e) {
			echo 'header("Content-type: application/pdf");'.$e;
			exit;
		}
	}
	function xls_month(){
		$company_code = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');
		$company = htmlentities($this->session->userdata('DCOMPANY_NAME'),ENT_QUOTES,'UTF-8');
		$periode = htmlentities($this->uri->segment('3'),ENT_QUOTES,'UTF-8');	
		$f_day = $periode."01";
				
		$judul = '';
        $headers = ''; // just creating the var for field headers to append to below
        $data = ''; // just creating the var for field data to append to below
        $footer = '';
        
        $obj =& get_instance();
		$headers .= "PT. ".$company."\n";
		$headers .= "DAILY PRODUCTION REPORT \n";
		$headers .= "PERIODE: ". $periode ."\n";
		$headers .= "\n";
		$headers .= "NO. \t";
		$headers .= "DATE \t";
		$headers .= "FFB INTI (For Day)\t";
		$headers .= "FFB INTI (Todate)\t";
		$headers .= "FFB PLASMA (For Day)\t";
		$headers .= "FFB PLASMA (Todate)\t";		
		$headers .= "FFB SUPPLIER (For Day)\t";
		$headers .= "FFB SUPPLIER (Todate)\t";
		$headers .= "FFB GROUP (For Day)\t";
		$headers .= "FFB GROUP (Todate)\t";
		$headers .= "TOTAL FFB (For Day)\t";
		$headers .= "TOTAL FFB (Todate)\t";
		$headers .= "BALANCE YESTERDAY \t";		
		$headers .= "FFB PROCESSED (For Day)\t";
		$headers .= "FFB PROCESSED (Todate)\t";
		$headers .= "BALANCE TODAY \t";
		$headers .= "PROCESSED HOUR (For Day)\t";
		$headers .= "PROCESSED HOUR (Todate)\t"; // todo
		$headers .= "THROUGHPUT (For Day)\t";
		$headers .= "THROUGHPUT (Todate)\t"; //todo
		$headers .= "MILL UTILIZATION\t";
		$headers .= "AVERAGE CAGE WEIGHT\t";
		$headers .= "CPO PRODUCTION (For Day)\t";
		$headers .= "CPO PRODUCTION (Todate)\t";
		$headers .= "OER (For Day)\t";
		$headers .= "OER SHI\t";
		$headers .= "FFA CPO PRODUCTION (For Day)\t"; 
		$headers .= "FFA CPO PRODUCTION (Todate)\t";
		$headers .= "FFA STOCK CPO1\t";
		$headers .= "FFA STOCK CPO2\t";
		$headers .= "FFA STOCK CPO3\t";
		$headers .= "FFA CPO STOCK\t";
		$headers .= "KERNEL PRODUCTION (For Day)\t";
		$headers .= "KERNEL PRODUCTION (Todate)\t";
		$headers .= "KER (For Day)\t";
		$headers .= "KER (Todate)\t"; //30
		$headers .= "SHELL (For Day)\t";
		$headers .= "SHELL (Todate)\t";
		$headers .= "% SHELL\t";
		$headers .= "EMPTY BUNCH (For Day)\t";
		$headers .= "EMPTY BUNCH (Todate)\t";
		$headers .= "% EMPTY BUNCH\t";
		$headers .= "ABU (For Day)\t";
		$headers .= "ABU (Todate)\t";
		$headers .= "% ABU\t";
		$headers .= "DISPATCH CPO (For Day)\t";
		$headers .= "DISPATCH RETURN \t";
		$headers .= "DISPATCH CPO (Todate)\t";
		$headers .= "DISPATCH KERNEL (For Day)\t";
		$headers .= "DISPATCH KERNEL (Todate)\t";
		$headers .= "DISPATCH SHELL (For Day)\t";
		$headers .= "DISPATCH SHELL (Todate)\t";
		$headers .= "DISPATCH EMPTY BUNCH (For Day)\t";
		$headers .= "DISPATCH EMPTY BUNCH (Todate)\t";
		$headers .= "DISPATCH ABU (For Day)\t";
		$headers .= "DISPATCH ABU (Todate)\t";
		$headers .= "STOCK CPO 1\t";
		$headers .= "STOCK CPO 2\t";
		$headers .= "STOCK CPO 3\t";
		$headers .= "STOCK CPO\t";
		$headers .= "STOCK CPO (Todate)\t";
		$headers .= "STOCK KERNEL 1\t";
		$headers .= "STOCK KERNEL 2\t";
		$headers .= "STOCK SHELL\t";
		$headers .= "STOCK EMPTY BUNCH\t";
		$headers .= "STOCK ABU\t";
		$headers .= "BUAH MENTAH\t";
		$headers .= "BUAH BUSUK\t";
		$headers .= "TANGKAI PANJANG\t";
		$headers .= "JANJANG KOSONG\t";
		$headers .= "BRONDOLAN\t";
		$headers .= "COMPANY CODE\t";
		$headers .= "INPUT DATE\t";
		$headers .= "APPROVE DATE\t";

		/*
		$headers .= "% FFB INTI \t";
		$headers .= "% FFB PLASMA \t";
		$headers .= "% FFB SUPPLIER \t";
		$headers .= "% FFB GROUP \t";
		$headers .= "% INTI PROCESSED\t";
		$headers .= "% PLASMA PROCESSED\t";
		$headers .= "% SUPPLIER PROCESSED\t";
		$headers .= "% GROUP PROCESSED\t";
		*/
		$no = 1;
		$oil_er_shi=0;
		$kernel_er_shi=0;
		$shell_er_shi=0;
		$empty_bunch_er_shi=0;
		$abu_er_shi=0;
		$ffa = 0;
		$ffa_shi = 0;
		$count_ffa = 0;		
		$oil_er=0;	
		$kernel_er=0;
		$shell_er=0;
		$empty_bunch_er=0;
		$abu_er=0;
		$throughput_shi=0;
		$data=$this->model_s_input_ba->get_ba_xls($company_code, $periode, $f_day);
		if($data!=NULL){
			foreach ($data as $row){
				if ($row['FFB_PROCESSED']== 0.00||$row['FFB_PROCESSED']==0){
					$oil_er=0;	
					$kernel_er=0;
					$shell_er=0;
					$empty_bunch_er=0;
					$abu_er=0;
				}else{
					$oil_er=$row['CPO_PROD']/$row['FFB_PROCESSED']*100;	
					$kernel_er=$row['KERNEL_PROD']/$row['FFB_PROCESSED']*100;
					$shell_er=$row['SHELL_PROD']/$row['FFB_PROCESSED']*100;
					$empty_bunch_er=$row['EMPTY_BUNCH_PROD']/$row['FFB_PROCESSED']*100;
					$abu_er=$row['ABU_PROD']/$row['FFB_PROCESSED']*100;
				}
				if ($row['FFB_PROCESSED_SHI']== 0.00||$row['FFB_PROCESSED_SHI']==0){
					$oil_er_shi=0;	
					$kernel_er_shi =0;
					//$shell_er_shi=0;
					//$empty_bunch_er_shi=0;
					//$abu_er_shi=0;
				}else{
					$oil_er_shi=($row['CPO_PROD_SHI']/$row['FFB_PROCESSED_SHI'])*100;	
					$kernel_er_shi =($row['KERNEL_PROD_SHI']/$row['FFB_PROCESSED_SHI'])*100;
					//$shell_er_shi=($row['SHELL_PROD_SHI']/$row['FFB_PROCESSED_SHI'])*100;
					//$empty_bunch_er_shi=($row['EMPTY_BUNCH_PROD_SHI']/$row['FFB_PROCESSED_SHI'])*100;
					//$abu_er_shi=($row['ABU_PROD_SHI']/$row['FFB_PROCESSED_SHI'])*100;
				}
				
				if ($row['PROCESSED_HOUR_SHI']== 0.00||$row['PROCESSED_HOUR_SHI']==0){
					$throughput_shi=0;	
				}else{
					$throughput_shi=$row['FFB_PROCESSED_SHI']/$row['PROCESSED_HOUR_SHI']/1000;
				}
				
				
				$ffa=$ffa+$row['FFA_PROD'];
				if ($row['FFA_PROD']<> 0.00||$row['FFA_PROD']<>0){
					$count_ffa++;
				}
				if ($count_ffa==0){
					$ffa_shi =$row['FFA_PROD'];
				}else{
					$ffa_shi = $ffa/$count_ffa;
				}
				$line = '';
				//$line .= str_replace('"', '""',$no)."\t";
				$line .= str_replace('"', '""',$no)."\t"; 
				$line .= str_replace('"', '""',$row['BA_DATE'])."\t";
				$line .= str_replace('"', '""',$row['FFB_INTI'])."\t";
				$line .= str_replace('"', '""',$row['FFB_INTI_SHI'])."\t";
				$line .= str_replace('"', '""',$row['FFB_PLASMA'])."\t";
				$line .= str_replace('"', '""',$row['FFB_PLASMA_SHI'])."\t";
				$line .= str_replace('"', '""',$row['FFB_SUPPLIER'])."\t";
				$line .= str_replace('"', '""',$row['FFB_SUPPLIER_SHI'])."\t";
				$line .= str_replace('"', '""',$row['FFB_GROUP'])."\t";
				$line .= str_replace('"', '""',$row['FFB_GROUP_SHI'])."\t";
				$line .= str_replace('"', '""',$row['TOTAL_FFB'])."\t";
				$line .= str_replace('"', '""',$row['TOTAL_FFB_SHI'])."\t";
				$line .= str_replace('"', '""',$row['BALANCE_YESTERDAY'])."\t";
				$line .= str_replace('"', '""',$row['FFB_PROCESSED'])."\t";
				$line .= str_replace('"', '""',$row['FFB_PROCESSED_SHI'])."\t";
				$line .= str_replace('"', '""',$row['BALANCE_TODAY'])."\t";			
				$line .= str_replace('"', '""',$row['PROCESSED_HOUR'])."\t";
				$line .= str_replace('"', '""',$row['PROCESSED_HOUR_SHI'])."\t";				
				$line .= str_replace('"', '""',$row['THROUGHPUT'])."\t";
				$line .= str_replace('"', '""',$throughput_shi)."\t";
				$line .= str_replace('"', '""',$row['MILL_UTILIZATION'])."\t";
				$line .= str_replace('"', '""',$row['CAGE_WEIGHT'])."\t";
				$line .= str_replace('"', '""',$row['CPO_PROD'])."\t";	
				$line .= str_replace('"', '""',$row['CPO_PROD_SHI'])."\t";	
				$line .= str_replace('"', '""',$oil_er)."\t";	
				$line .= str_replace('"', '""',$oil_er_shi)."\t";			
				$line .= str_replace('"', '""',$row['FFA_PROD'])."\t";
				$line .= str_replace('"', '""',$ffa_shi)."\t";				
				$line .= str_replace('"', '""',$row['FFA_STOCK_CPO1'])."\t";
				$line .= str_replace('"', '""',$row['FFA_STOCK_CPO2'])."\t";
				$line .= str_replace('"', '""',$row['FFA_STOCK_CPO3'])."\t";
				$line .= str_replace('"', '""',$row['FFA_STOCK'])."\t";			
				$line .= str_replace('"', '""',$row['KERNEL_PROD'])."\t";
				$line .= str_replace('"', '""',$row['KERNEL_PROD_SHI'])."\t";
				$line .= str_replace('"', '""',$kernel_er)."\t";//30
				$line .= str_replace('"', '""',$kernel_er_shi)."\t";
				$line .= str_replace('"', '""',$row['SHELL_PROD'])."\t";
				$line .= str_replace('"', '""',$row['SHELL_PROD_SHI'])."\t";
				$line .= str_replace('"', '""',$shell_er)."\t";
				$line .= str_replace('"', '""',$row['EMPTY_BUNCH_PROD'])."\t";
				$line .= str_replace('"', '""',$row['EMPTY_BUNCH_PROD_SHI'])."\t";
				$line .= str_replace('"', '""',$empty_bunch_er)."\t";
				$line .= str_replace('"', '""',$row['ABU_PROD'])."\t";
				$line .= str_replace('"', '""',$row['ABU_PROD_SHI'])."\t";
				$line .= str_replace('"', '""',$abu_er)."\t";		
				$line .= str_replace('"', '""',$row['DISPATCH_CPO'])."\t";
				$line .= str_replace('"', '""',$row['DISPATCH_RETURN'])."\t";
				$line .= str_replace('"', '""',$row['DISPATCH_CPO_SHI'])."\t";
				$line .= str_replace('"', '""',$row['DISPATCH_KERNEL'])."\t";
				$line .= str_replace('"', '""',$row['DISPATCH_KERNEL_SHI'])."\t";
				$line .= str_replace('"', '""',$row['DISPATCH_SHELL'])."\t";
				$line .= str_replace('"', '""',$row['DISPATCH_SHELL_SHI'])."\t";
				$line .= str_replace('"', '""',$row['DISPATCH_EMPTY_BUNCH'])."\t";
				$line .= str_replace('"', '""',$row['DISPATCH_EMPTY_BUNCH_SHI'])."\t";	
				$line .= str_replace('"', '""',$row['DISPATCH_ABU'])."\t";	
				$line .= str_replace('"', '""',$row['DISPATCH_ABU_SHI'])."\t";	
				$line .= str_replace('"', '""',$row['STOCK_CPO1'])."\t";	
				$line .= str_replace('"', '""',$row['STOCK_CPO2'])."\t";	
				$line .= str_replace('"', '""',$row['STOCK_CPO3'])."\t";	
				$line .= str_replace('"', '""',$row['STOCK_CPO'])."\t";
				$line .= str_replace('"', '""',$row['STOCK_CPO_SHI'])."\t";
				$line .= str_replace('"', '""',$row['STOCK_KERNEL1'])."\t";
				$line .= str_replace('"', '""',$row['STOCK_KERNEL2'])."\t";
				//$line .= str_replace('"', '""',)."\t";
				$line .= str_replace('"', '""',$row['STOCK_SHELL'])."\t";
				$line .= str_replace('"', '""',$row['STOCK_EMPTY_BUNCH'])."\t";
				$line .= str_replace('"', '""',$row['STOCK_ABU'])."\t";
				$line .= str_replace('"', '""',$row['BUAH_MENTAH'])."\t";
				$line .= str_replace('"', '""',$row['BUAH_BUSUK'])."\t";
				$line .= str_replace('"', '""',$row['TANGKAI'])."\t";
				$line .= str_replace('"', '""',$row['JJK'])."\t";
				$line .= str_replace('"', '""',$row['BRONDOLAN'])."\t";
				$line .= str_replace('"', '""',$row['COMPANY_CODE'])."\t";
				$line .= str_replace('"', '""',$row['INPUT_DATE'])."\t";
				$line .= str_replace('"', '""',$row['APPROVED_DATE'])."\t";
				$no++;
				$data .= trim($line)."\n"; 
	
		/*
			$headers .= "% FFB INTI \t";
			$headers .= "% FFB PLASMA \t";
			$headers .= "% FFB SUPPLIER \t";
			$headers .= "% FFB GROUP \t";
			$headers .= "% INTI PROCESSED\t";
			$headers .= "% PLASMA PROCESSED\t";
			$headers .= "% SUPPLIER PROCESSED\t";
			$headers .= "% GROUP PROCESSED\t";
			*/
			
			}
			$data = str_replace("\r","",$data);
			$data = str_replace("Array","",$data);
		
		 //header("Content-type: application/vnd.ms-excel");
        header("Cache-Control: no-cache, must-revalidate");
        header("Pragma: no-cache");
        header("Content-type: application/x-msdownload;");
        header("Content-Disposition: attachment; filename=Rekap_BA_".$company."_".$periode.".xls");
        echo "$judul\n$headers\n$data";
		}
		

	}
	
	function pdf(){
require_once(APPPATH . '/libraries/html2pdf/html2pdf.class.php');

		ob_start();
		// Tampilkan HTML untuk di jadikan PDF //
		//$content = ob_get_clean();
		$content='';
		$company_code = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');
		$company = htmlentities($this->session->userdata('DCOMPANY_NAME'),ENT_QUOTES,'UTF-8');
		$periode = htmlentities($this->uri->segment('3'),ENT_QUOTES,'UTF-8');
		$f_day = $periode."01";
		$data=$this->model_s_input_ba->get_data_ba($company_code, $periode, $f_day);
		$content = "
		<style> .tbl_header { font-size: 12px; border-top:1px solid;border-left:1px solid} 
.tbl_th { font-size: 10px; border-bottom:1px solid; border-right:1px solid} 
.tbl_header2 { font-size: 18px; border-bottom:2px solid; border-right:1px solid} 
.tbl_header3 { font-size: 10px; border-bottom:2px solid} 
.tbl_header4 { font-size: 12px; border-bottom:2px solid; border-right:1px solid} 
.tbl_td { font-size: 10px; border-bottom:1px solid; border-right:1px solid} 
.tbl_td2 {border-right:1px solid} 
.tbl_2 { font-size: 12px;color:#678197;} 
.content { font-size: 12px;color:#678197; } .content2 { font-size: 11px;color:#678197; } </style>
<table width='100%' class='tbl_header' cellpadding='0' cellspacing='0'>
<tr>    
    <td colspan='6' align='center' class='tbl_header4' height='40'>PT. ".$company." </td>
    <td colspan='13' align='center' class='tbl_header2' height='40'>BERITA ACARA PRODUKSI HARIAN</td>
    <td colspan='5' align='center' class='tbl_header4' height='40'>PERIODE ".$periode." </td>
  </tr>
  <tr>
    <td rowspan='3' align='center' class='tbl_th' width='40'>TGL</td>   
    <td colspan='5' class='tbl_th' align='center'>TBS</td>
    <td colspan='11' class='tbl_th' align='center'>CPO</td>
    <td colspan='7' class='tbl_th' align='center'>KERNEL</td>
  </tr>
  <tr>
    <td colspan='2' class='tbl_th' align='center' width='85'>TERIMA</td>
    <td colspan='2' class='tbl_th' align='center' width='85'>OLAH</td>
    <td rowspan='2' class='tbl_th' align='center' width='40'>RESTAN PABRIK</td>
    <td colspan='2' class='tbl_th' align='center' width='85'> PRODUKSI</td>
    <td colspan='2' class='tbl_th' align='center' width='60'>ER </td>
    <td colspan='2' class='tbl_th' align='center' width='60'>FFA PROD</td>
    <td rowspan='2' class='tbl_th' align='center' width='35'>FFA STOCK</td>
    <td colspan='2' class='tbl_th' align='center' width='85'>DISPATCH </td>
    <td colspan='2' class='tbl_th' align='center' width='85'>STOCK</td>
    <td colspan='2' class='tbl_th' align='center' width='85'>PRODUKSI</td>
    <td colspan='2' class='tbl_th' align='center' width='60'>ER </td>
    <td colspan='2' class='tbl_th' align='center' width='85'>DISPATCH </td>
    <td rowspan='2' class='tbl_th' align='center' width='50'>STOCK </td>
  </tr>
  <tr>
    
    <td class='tbl_th' align='center'>HI</td>
    <td class='tbl_th' align='center'>SHI</td>
    <td class='tbl_th' align='center'>HI</td>
    <td class='tbl_th' align='center'>SHI</td>
    <td class='tbl_th' align='center'>HI</td>
    <td class='tbl_th' align='center'>SHI</td>
    <td class='tbl_th' align='center'>HI</td>
    <td class='tbl_th' align='center'>SHI</td>
    <td class='tbl_th' align='center'>HI</td>
    <td class='tbl_th' align='center'>SHI</td>
    <td class='tbl_th' align='center'>HI</td>
    <td class='tbl_th' align='center'>SHI</td>
    <td class='tbl_th' align='center'>TANK 1</td>
    <td class='tbl_th' align='center'>TANK 2</td>
    <td class='tbl_th' align='center'>HI</td>
    <td class='tbl_th' align='center'>SHI</td>
    <td class='tbl_th' align='center'>HI</td>
    <td class='tbl_th' align='center'>SHI</td>
    <td class='tbl_th' align='center'>HI</td>
    <td class='tbl_th' align='center'>SHI</td>
  </tr>
";

//var_dump($content);
$oil_er_shi=0;
$kernel_er_shi=0;
$ffa = 0;
$count_ffa = 0;
$ffa_shi = 0;
$oil_er=0;	
$kernel_er=0;
if ($data<>NULL){
 foreach($data as $row){
        $content.="<tr>";
		if ($row['FFB_PROCESSED']== 0.00||$row['FFB_PROCESSED']==0){
			$oil_er=0;	
			$kernel_er=0;
		}else{
			$oil_er=$row['CPO_PROD']/$row['FFB_PROCESSED']*100;	
			$kernel_er=$row['KERNEL_PROD']/$row['FFB_PROCESSED']*100;
		}
		if ($row['FFB_PROCESSED_SHI']== 0.00||$row['FFB_PROCESSED_SHI']==0){
			$oil_er_shi=0;	
			$kernel_er_shi =0;
		}else{
			$oil_er_shi=($row['CPO_PROD_SHI']/$row['FFB_PROCESSED_SHI'])*100;	
			$kernel_er_shi =($row['KERNEL_PROD_SHI']/$row['FFB_PROCESSED_SHI'])*100;
		}
		
		$ffa=$ffa+$row['FFA_PROD'];
		if ($row['FFA_PROD']<> 0.00||$row['FFA_PROD']<>0){
			$count_ffa++;
		}
		if ($count_ffa==0){
			$ffa_shi =$row['FFA_PROD'];
		}else{
			$ffa_shi = $ffa/$count_ffa;
		}
		
		$qc=$row['QC'];
		$labor=$row['LABOR'];
		$mill=$row['MILL_MANAGER'];
		$adm=$row['ADMINISTRATUR'];
		$ktu=$row['KTU'];
		
        $content.="<td class='tbl_td' align='center'>".$row['BA_DATE']."</td>";		 
        $content.="<td class='tbl_td' align='right'>".number_format($row['FFB'],2)."</td>";
        $content.="<td class='tbl_td' align='right'>".number_format($row['FFB_SHI'],2)."</td>";
        $content.="<td class='tbl_td' align='right'>".number_format($row['FFB_PROCESSED'],2)."</td>";
        $content.="<td class='tbl_td' align='right'>".number_format($row['FFB_PROCESSED_SHI'],2)."</td>";
        $content.="<td class='tbl_td' align='right'>".number_format($row['BALANCE_YESTERDAY'],2)."</td>";
		$content.="<td class='tbl_td' align='right'>".number_format($row['CPO_PROD'],2)."</td>";
		$content.="<td class='tbl_td' align='right'>".number_format($row['CPO_PROD_SHI'],2)."</td>";
		$content.="<td class='tbl_td' align='right'>".number_format($oil_er,2)."</td>";
		$content.="<td class='tbl_td' align='right'>".number_format($oil_er_shi,2)."</td>";
		$content.="<td class='tbl_td' align='right'>".number_format($row['FFA_PROD'],2)."</td>";
		$content.="<td class='tbl_td' align='right'>".number_format($ffa_shi,2)."</td>";
		$content.="<td class='tbl_td' align='right'>".number_format($row['FFA_STOCK'],2)."</td>";
		$content.="<td class='tbl_td' align='right'>".number_format($row['DISPATCH_CPO'],2)."</td>";
		$content.="<td class='tbl_td' align='right'>".number_format($row['DISPATCH_CPO_SHI'],2)."</td>";
		$content.="<td class='tbl_td' align='right'>".number_format($row['STOCK_CPO1'],2)."</td>";
		$content.="<td class='tbl_td' align='right'>".number_format($row['STOCK_CPO2'],2)."</td>";
		$content.="<td class='tbl_td' align='right'>".number_format($row['KERNEL_PROD'],2)."</td>";
		$content.="<td class='tbl_td' align='right'>".number_format($row['KERNEL_PROD_SHI'],2)."</td>";
		$content.="<td class='tbl_td' align='right'>".number_format($kernel_er,2)."</td>";
		$content.="<td class='tbl_td' align='right'>".number_format($kernel_er_shi,2)."</td>";
		$content.="<td class='tbl_td' align='right'>".number_format($row['DISPATCH_KERNEL'],2)."</td>";
		$content.="<td class='tbl_td' align='right'>".number_format($row['DISPATCH_KERNEL_SHI'],2)."</td>";
		$content.="<td class='tbl_td' align='right'>".number_format($row['STOCK_KERNEL1']+$row['STOCK_KERNEL2'],2)."</td>";
		$content.="<td class='tbl_td' align='right'></td>";
		
        $content.='</tr>';
		
        
    }

	
        $content.="
			<tr>
				<td colspan='24' height='20'>&nbsp;</td>
				<td class='tbl_td2'>&nbsp;</td>
			</tr>
			<tr>
				<td colspan='2'>&nbsp;</td>
				<td colspan='8' align='center'>Prepared By</td>
				<td colspan='8' align='center'>Checked By</td>
				<td colspan='5' align='center'>Approved By</td>
				<td class='tbl_td2' colspan='2'>&nbsp;</td>
			 </tr>
			 <tr>
				<td colspan='24' height='30'>&nbsp;</td>
				<td class='tbl_td2'>&nbsp;</td>
			</tr>";
			$content.="<tr>";
			$content.="<td colspan='2'>&nbsp;</td>";
			$content.="<td colspan='4' align='center'>".$qc."</td>";
			$content.="<td colspan='4' align='center'>".$labor."</td>";
			$content.="<td colspan='4' align='center'>".$mill."</td>";
			$content.="<td colspan='4' align='center'>".$ktu."</td>";
			$content.="<td colspan='5' align='center'>".$adm."</td>";
			$content.="<td class='tbl_td2' colspan='2'>&nbsp;</td>";
			$content.="</tr>";
			
			$content.="<tr>";
			$content.="<td colspan='2'>&nbsp;</td>";
			$content.="<td colspan='4' align='center'>Quality Control</td>";
			$content.="<td colspan='4' align='center'>Ast. Lab</td>";
			$content.="<td colspan='4' align='center'>Mill Manager</td>";
			$content.="<td colspan='4' align='center'>KTU</td>";
			$content.="<td colspan='5' align='center'>Administratur</td>";
			$content.="<td class='tbl_td2' colspan='2'>&nbsp;</td>";
			$content.="</tr>";
}//end if
			$content.="<tr>
				<td class='tbl_header3' colspan='24' height='5'>&nbsp;</td>
				<td class='tbl_header4'>&nbsp;</td>
			</tr>";
		$content.="</table>";

		try{
			//ob_end_clean();
			$html2pdf = new HTML2PDF('L', 'Folio', 'en', true, 'UTF-8', array(5, 15, 5, 5));
			$html2pdf->pdf->SetDisplayMode('fullpage');
			$html2pdf->setDefaultFont('Arial');
			$html2pdf->writeHTML($content);
			$html2pdf->Output("Rekap_BA_".$company_code."_".$periode.".pdf");
		}catch(HTML2PDF_exception $e) {
			echo 'header("Content-type: application/pdf");'.$e;
			exit;
		}
		
	}
	
	/*
		Algoritma get_approval() sebaiknya d perbiki
	*/
	function get_approval(){
		$company = $this->session->userdata('DCOMPANY');
		$data_enroll = $this->model_s_input_ba->get_approval($company);
		foreach($data_enroll as $row){
			//$data[] = array("QC"=>($row['QC']),"LABOR"=>($row['LABOR']),"MILL"=>($row['MILL']),"KTU"=>($row['KTU']),"ADM"=>($row['ADM']),"ID_APPROVAL"=>($row['ID_APPROVAL']));	
			$data = '~'.$row['MILL'].'~'.$row['KTU'].'~'.$row['ADM'].'~'.$row['ID_APPROVAL'].'~'.$row['QC'].'~'.$row['LABOR'].'~'.$row['COMPANY_CODE'].'~';
        }
		$storeData = json_encode($data);
        echo $storeData;
	}
	
	function get_tbs(){
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');
        $tanggalm = htmlentities($this->uri->segment('3'),ENT_QUOTES,'UTF-8');
        $data_tbs = $this->model_s_input_ba->get_tbs($company,$tanggalm);
		if ($data_tbs!=NULL){
			foreach($data_tbs as $row)
			{
				$tbs = str_replace('"','\\"',htmlentities($row['TBS_INTI'],ENT_QUOTES,'UTF-8')). "~" . str_replace('"','\\"',htmlentities($row['TBS_SUPPLIER'],ENT_QUOTES,'UTF-8')). "~" . str_replace('"','\\"',htmlentities($row['TBS_GROUP'],ENT_QUOTES,'UTF-8')). "~" . str_replace('"','\\"',htmlentities($row['TBS_PLASMA'],ENT_QUOTES,'UTF-8'));
				
			}
			echo $tbs;
		}
		
    }
	
	function get_restan(){
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');
        $tanggalm = htmlentities($this->uri->segment('3'),ENT_QUOTES,'UTF-8');
        $balance_yesterday = $this->model_s_input_ba->get_restan($company,$tanggalm);
		
		$balance = str_replace('"','\\"',htmlentities($balance_yesterday,ENT_QUOTES,'UTF-8'));
		echo $balance;
    }
	
	function get_buahmentah(){
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');
        $tanggalm = htmlentities($this->uri->segment('3'),ENT_QUOTES,'UTF-8');
		$type = htmlentities($this->uri->segment('4'),ENT_QUOTES,'UTF-8');
        $grading= $this->model_s_input_ba->get_grading($company,$tanggalm,$type);
		
		$grading = str_replace('"','\\"',htmlentities($grading,ENT_QUOTES,'UTF-8'));
		echo $grading;
    }
	
	/*
	function get_ffb_processed(){
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');
		
        $tanggalm = htmlentities($this->uri->segment('3'),ENT_QUOTES,'UTF-8');
		$day=preg_split('/[- :]/',trim($tanggalm));
		$day=implode('',$day);
		$yesterday = strtotime('-1 day',strtotime($day)); 
		$yesterday = date('Ymd', $yesterday);
		
        $balance_yesterday = $this->model_s_input_ba->get_restan($company,$yesterday);		
		$balance_today = $this->model_s_input_ba->get_restan($company,$tanggalm);
		$tbs = $this->model_s_input_ba->get_tbs($company,$tanggalm);	
    }
	*/
	
    function LoadData(){
        $periode = htmlentities($this->uri->segment('3'),ENT_QUOTES,'UTF-8'); 
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');
        echo json_encode($this->model_s_input_ba->LoadData($periode,$company));   
    }
    
	function LoadData_Commodity(){
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');        
        echo json_encode($this->model_s_input_ba->LoadData_Commodity($company));   
    }
	
	function LoadData_OtherStock(){
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');        
        echo json_encode($this->model_s_input_ba->LoadData_OtherStock($company));   
    }
	
	function LoadData_Storage(){
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');        
        echo json_encode($this->model_s_input_ba->LoadData_Storage($company));   
    }
	
	function LoadDetail_Production($id_ba){
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');        
        echo json_encode($this->model_s_input_ba->LoadDetail_Production($company, $id_ba));   
    }
	
	function LoadProductionByDate($date){
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');        
        echo json_encode($this->model_s_input_ba->LoadProductionByDate($company, $date));   
    }
	
	function LoadNoProductionByDate($date){
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');        
        echo json_encode($this->model_s_input_ba->LoadNoProductionByDate($company, $date));   
    }
	
	function LoadDispatchByDate($date){
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');        
        echo json_encode($this->model_s_input_ba->LoadDispatchByDate($company, $date));   
    }
	
	function LoadStorageByDate($date){
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');        
        echo json_encode($this->model_s_input_ba->LoadStorageByDate($company, $date));   
    }
	
	function LoadOtherStockByDate($date){
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');        
        echo json_encode($this->model_s_input_ba->LoadOtherStockByDate($company, $date));   
    }
	
	function LoadDetail_Dispatch($id_ba){
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');        
        echo json_encode($this->model_s_input_ba->LoadDetail_Dispatch($company, $id_ba));   
    }
	
	function LoadDetail_Stock($id_ba){
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');        
        echo json_encode($this->model_s_input_ba->LoadDetail_Stock($company, $id_ba));   
    }
	
	function LoadDetail_StorageStock($id_ba){
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');        
        echo json_encode($this->model_s_input_ba->LoadDetail_StorageStock($company, $id_ba));   
    }
	
    function search_data(){
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');

        $data = json_decode($this->input->post('filters'), true);
        echo json_encode($this->model_s_input_ba->data_search($data['rules'], $company));    
    } 
	
    function add_new($data_id, $data_prod, $data_dispatch, $data_stock, $data_storage, $data_performance){
		//Start for Master BA
        $return['status']='';
        $return['error']=FALSE;
        $company = trim(htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8'));
        
        $data_post['ID_BA'] = trim($this->global_func->createMy_ID('s_ba','ID_BA',$company."BA","BA_DATE",$company));
        $data_post['BA_DATE'] = strtoupper(trim(htmlentities($data_id['BA_DATE'],ENT_QUOTES,'UTF-8'))) ;
        $data_post['QC']=strtoupper(trim(htmlentities($data_id['QC'],ENT_QUOTES,'UTF-8'))) ;
		$data_post['MILL_MANAGER']=strtoupper(trim(htmlentities($data_id['MILL_MANAGER'],ENT_QUOTES,'UTF-8'))) ;
		$data_post['KTU']=strtoupper(trim(htmlentities($data_id['KTU'],ENT_QUOTES,'UTF-8')));
		$data_post['ADMINISTRATUR']=strtoupper(trim(htmlentities($data_id['ADMINISTRATUR'],ENT_QUOTES,'UTF-8')));
		$data_post['LABOR']=strtoupper(trim(htmlentities($data_id['LABOR'],ENT_QUOTES,'UTF-8')));
		$data_post['DESCRIPTION']=strtoupper(trim(htmlentities($data_id['DESCRIPTION'],ENT_QUOTES,'UTF-8')));
        
		$data_post['FFB_INTI']=strtoupper(trim(htmlentities($data_id['FFB_INTI'],ENT_QUOTES,'UTF-8')));
		$data_post['FFB_PLASMA']=strtoupper(trim(htmlentities($data_id['FFB_PLASMA'],ENT_QUOTES,'UTF-8')));
		$data_post['FFB_SUPPLIER']=strtoupper(trim(htmlentities($data_id['FFB_SUPPLIER'],ENT_QUOTES,'UTF-8')));
		$data_post['FFB_GROUP']=strtoupper(trim(htmlentities($data_id['FFB_GROUP'],ENT_QUOTES,'UTF-8')));		
		$data_post['FFB_PROCESSED']=strtoupper(trim(htmlentities($data_id['FFB_PROCESSED'],ENT_QUOTES,'UTF-8')));
		$data_post['BALANCE_YESTERDAY']=strtoupper(trim(htmlentities($data_id['BALANCE_YESTERDAY'],ENT_QUOTES,'UTF-8')));
		$data_post['LORI_OLAH']=strtoupper(trim(htmlentities($data_id['LORI_OLAH'],ENT_QUOTES,'UTF-8')));
		$data_post['LORI_RESTAN']=strtoupper(trim(htmlentities($data_id['LORI_RESTAN'],ENT_QUOTES,'UTF-8')));
		if ($data_id['LORI_RESTAN']==0 && $data_id['LORI_OLAH']>0){
			$data_post['BALANCE']=0;
		}else{
			$data_post['BALANCE']=(($data_post['FFB_INTI']+$data_post['FFB_PLASMA']+$data_post['FFB_SUPPLIER']+$data_post['FFB_GROUP']+$data_post['BALANCE_YESTERDAY'])-$data_post['FFB_PROCESSED']);
		}
		$data_post['CAGE_WEIGHT']=strtoupper(trim(htmlentities($data_id['CAGE_WEIGHT'],ENT_QUOTES,'UTF-8')));
		
		$data_post['BUAH_MENTAH']=strtoupper(trim(htmlentities($data_id['BUAH_MENTAH'],ENT_QUOTES,'UTF-8')));
		$data_post['BUAH_BUSUK']=strtoupper(trim(htmlentities($data_id['BUAH_BUSUK'],ENT_QUOTES,'UTF-8')));
		$data_post['JJK']=strtoupper(trim(htmlentities($data_id['JJK'],ENT_QUOTES,'UTF-8')));
		$data_post['TANGKAI']=strtoupper(trim(htmlentities($data_id['TANGKAI'],ENT_QUOTES,'UTF-8')));
		$data_post['BRONDOLAN']=strtoupper(trim(htmlentities($data_id['BRONDOLAN'],ENT_QUOTES,'UTF-8')));
		$data_post['HOUR_FROM']=strtoupper(trim(htmlentities($data_id['HOUR_FROM'],ENT_QUOTES,'UTF-8')));
		$data_post['HOUR_TO']=strtoupper(trim(htmlentities($data_id['HOUR_TO'],ENT_QUOTES,'UTF-8')));
		$data_post['CBC_FROM']=strtoupper(trim(htmlentities($data_id['CBC_FROM'],ENT_QUOTES,'UTF-8')));
		$data_post['CBC_TO']=strtoupper(trim(htmlentities($data_id['CBC_TO'],ENT_QUOTES,'UTF-8')));
				
		$data_post['INPUT_BY'] = trim(htmlentities($this->session->userdata('LOGINID'),ENT_QUOTES,'UTF-8')); 
        $data_post['COMPANY_CODE'] = $company;
		
		
		$field = $data_post['BA_DATE'];		
		$validate_approve=$this->validate_approve($field);
        if( strtolower($validate_approve)=='false'){
            $return['status'] ="BA tanggal ".$field. " tidak dapat disimpan karena BA tanggal sebelumnya belum di APPROVE atau di INPUT";
            $return['error']=true;        
        }
		
        //add BA validation code here!!!
		$field = $data_post['BUAH_MENTAH'];
		$validate_numeric=$this->validate_numeric($field);		
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai Buah mentah harus angka";
            $return['error']=true;        
        }
		
		$field = $data_post['BUAH_BUSUK'];
		$validate_numeric=$this->validate_numeric($field);		
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai Buah busuk harus angka";
            $return['error']=true;        
        }
		
		$field = $data_post['JJK'];
		$validate_numeric=$this->validate_numeric($field);		
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai JJK harus angka";
            $return['error']=true;        
        }
		
		$field = $data_post['BRONDOLAN'];
		$validate_numeric=$this->validate_numeric($field);		
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai brondolan harus angka";
            $return['error']=true;        
        }
		
		$field = $data_post['CBC_FROM'];
		$validate_numeric=$this->validate_numeric($field);		
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai CBC harus angka";
            $return['error']=true;        
        }
		
		$field = $data_post['CBC_TO'];
		$validate_numeric=$this->validate_numeric($field);		
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai CBC harus angka";
            $return['error']=true;        
        }
		
		$field = $data_post['TANGKAI'];
		$validate_numeric=$this->validate_numeric($field);		
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai panjang tangkai harus angka";
            $return['error']=true;        
        }
		
		$ba_date=strval($data_post['BA_DATE']);
        if(empty($ba_date) || $ba_date==null || $ba_date==false){
            $return['status']="Tanggal berita acara tidak boleh kosong";
            $return['error']=true;
        }else{ 
            if(date("Ymd",strtotime($ba_date)) == '19700101'){
                $return['status']="format tanggal salah";
                $return['error']=true;
            }
        }
		
		$field = $data_post['FFB_INTI'];
		$validate_numeric=$this->validate_numeric($field);
		
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai FFB Inti harus angka";
            $return['error']=true;        
        }		
		if(strlen($data_post['FFB_INTI']) > 50){
            $return['status']  ="Panjang karakter FFB Inti melebihi batas maksimal";
            $return['error']=true;
        }
		
		$field = $data_post['FFB_PLASMA'];
		$validate_numeric=$this->validate_numeric($field);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai FFB Plasma harus angka";
            $return['error']=true;        
        }
		if(strlen($data_post['FFB_PLASMA']) > 50){
            $return['status']  ="Panjang karakter FFB plasma melebihi batas maksimal";
            $return['error']=true;
        }
		
		$field = $data_post['FFB_SUPPLIER'];
		$validate_numeric=$this->validate_numeric($field);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai FFB supplier harus angka";
            $return['error']=true;        
        }
		if(strlen($data_post['FFB_SUPPLIER']) > 50){
            $return['status']  ="Panjang karakter FFB supplier melebihi batas maksimal";
            $return['error']=true;
        }
		
		$field = $data_post['FFB_GROUP'];
		$validate_numeric=$this->validate_numeric($field);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai FFB group harus angka";
            $return['error']=true;        
        }
		if(strlen($data_post['FFB_GROUP']) > 50){
            $return['status']  ="Panjang karakter FFB group melebihi batas maksimal";
            $return['error']=true;
        }
		
		$field = $data_post['FFB_PROCESSED'];
		$validate_numeric=$this->validate_numeric($field);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai FFB processed harus angka";
            $return['error']=true;        
        }
		if(strlen($data_post['FFB_PROCESSED']) > 50){
            $return['status']  ="Panjang karakter FFB processed melebihi batas maksimal";
            $return['error']=true;
        }
		
		$field = $data_post['CAGE_WEIGHT'];
		$validate_numeric=$this->validate_numeric($field);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai cage weight harus angka";
            $return['error']=true;        
        }
		
		if(strlen($data_post['CAGE_WEIGHT']) > 50){
            $return['status']  ="Panjang karakter cage weight melebihi batas maksimal";
            $return['error']=true;
        }
		
		$field = $data_post['BALANCE_YESTERDAY'];
		$validate_numeric=$this->validate_numeric($field);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai balance yesterday harus angka";
            $return['error']=true;        
        }		
		if(strlen($data_post['BALANCE_YESTERDAY']) > 50){
            $return['status']  ="Panjang karakter balance yesterday melebihi batas maksimal";
            $return['error']=true;
        }
		
		$field = $data_post['LORI_OLAH'];
		$validate_numeric=$this->validate_numeric($field);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai lori olah harus angka";
            $return['error']=true;        
        }		
		if(strlen($data_post['LORI_OLAH']) > 50){
            $return['status']  ="Panjang karakter lori olah melebihi batas maksimal";
            $return['error']=true;
        }
		
		$field = $data_post['LORI_RESTAN'];
		$validate_numeric=$this->validate_numeric($field);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai lori restan harus angka";
            $return['error']=true;        
        }		
		if(strlen($data_post['LORI_RESTAN']) > 50){
            $return['status']  ="Panjang karakter lori restan melebihi batas maksimal";
            $return['error']=true;
        }
		
		//end for Master BA
		//start: production
		$data_post_d = array();		
		$int=0;
		$tmp_identifier=0;
		foreach($data_prod as $key => $val){			
			$int = filter_var($key, FILTER_SANITIZE_NUMBER_INT);			
            $tmp_identifier=$int;		
			if (preg_match('/PRODUCTION_DATE/',$key)){
				$a = array('PRODUCTION_DATE'=>$val);
				$data_post_d[$tmp_identifier]=$a;
			}elseif (preg_match('/ID_COMMODITY/',$key)){
				if($val==''){
                    $return['status']="PRODUCTION commodity code pada baris ".$int." tidak boleh kosong   \r\n";
                    $return['error']=true;   
                }else{
					$data_post_d[$tmp_identifier]=array_merge((array)$data_post_d[$tmp_identifier],array('ID_COMMODITY'=>$val));
				}
			}elseif (preg_match('/COMPANY_CODE/',$key)){
				$data_post_d[$tmp_identifier]=array_merge((array)$data_post_d[$tmp_identifier],array('COMPANY_CODE'=>$val));
			}elseif (preg_match('/WEIGHT/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom production pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_d[$tmp_identifier]=array_merge((array)$data_post_d[$tmp_identifier],array('WEIGHT'=>$val));	
				}
			}elseif (preg_match('/FFA/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom FFA PRODUCTION pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_d[$tmp_identifier]=array_merge((array)$data_post_d[$tmp_identifier],array('FFA'=>$val));	
				}				
			}elseif (preg_match('/MOISTURE/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom MOISTURE PRODUCTION pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_d[$tmp_identifier]=array_merge((array)$data_post_d[$tmp_identifier],array('MOISTURE'=>$val));	
				}					
			}elseif (preg_match('/DIRT/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom DIRTY PRODUCTION pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_d[$tmp_identifier]=array_merge((array)$data_post_d[$tmp_identifier],array('DIRT'=>$val));	
				}				
			}
			$data_post_d[$tmp_identifier]=array_merge((array)$data_post_d[$tmp_identifier],array('ID_BA'=>$data_post['ID_BA']));			
		}
		//end: production
				
		//start: dispatch
		$data_post_dispatch = array();
		$int=0;
		$tmp_identifier=0;
		foreach($data_dispatch as $key => $val){			
			$int = filter_var($key, FILTER_SANITIZE_NUMBER_INT);			
            $tmp_identifier=$int;	
			if (preg_match('/DISPATCH_DATE/',$key)){
				$b = array('DISPATCH_DATE'=>$val);
				$data_post_dispatch[$tmp_identifier]=$b;
			}elseif (preg_match('/ID_COMMODITY/',$key)){
				if($val==''){
                    $return['status']="DISPATCH commodity code pada baris ".$int." tidak boleh kosong   \r\n";
                    $return['error']=true;   
                }else{
					$data_post_dispatch[$tmp_identifier]=array_merge((array)$data_post_dispatch[$tmp_identifier],array('ID_COMMODITY'=>$val));
				}
				
			}elseif (preg_match('/COMPANY_CODE/',$key)){
				$data_post_dispatch[$tmp_identifier]=array_merge((array)$data_post_dispatch[$tmp_identifier],array('COMPANY_CODE'=>$val));
			}elseif (preg_match('/WEIGHT/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom DISPATCH (Kg) pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_dispatch[$tmp_identifier]=array_merge((array)$data_post_dispatch[$tmp_identifier],array('WEIGHT'=>$val));
				}				
			}elseif (preg_match('/FFA/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom FFA - dispatch pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_dispatch[$tmp_identifier]=array_merge((array)$data_post_dispatch[$tmp_identifier],array('FFA'=>$val));	
				}				
			}elseif (preg_match('/MOISTURE/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom MOISTURE-dispatch pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_dispatch[$tmp_identifier]=array_merge((array)$data_post_dispatch[$tmp_identifier],array('MOISTURE'=>$val));	
				}					
			}elseif (preg_match('/DIRT/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom DIRTY - dispatch pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_dispatch[$tmp_identifier]=array_merge((array)$data_post_dispatch[$tmp_identifier],array('DIRT'=>$val));	
				}				
			}
			$data_post_dispatch[$tmp_identifier]=array_merge((array)$data_post_dispatch[$tmp_identifier],array('ID_BA'=>$data_post['ID_BA']));				
		}	
		//end: dispatch
		//start: stock
		$data_post_stock = array();
		$int=0;
		$tmp_identifier=0;
		foreach($data_stock as $key => $val){			
			$int = filter_var($key, FILTER_SANITIZE_NUMBER_INT);			
            $tmp_identifier=$int;	
			if (preg_match('/STOCK_DATE/',$key)){
				$c = array('STOCK_DATE'=>$val);
				$data_post_stock[$tmp_identifier]=$c;
			}elseif (preg_match('/ID_COMMODITY/',$key)){
				if($val==''){
                    $return['status']="STOCK commodity code pada baris ".$int." tidak boleh kosong   \r\n";
                    $return['error']=true;   
                }else{
					$data_post_stock[$tmp_identifier]=array_merge((array)$data_post_stock[$tmp_identifier],array('ID_COMMODITY'=>$val));
				}
				
			}elseif (preg_match('/COMPANY_CODE/',$key)){
				$data_post_stock[$tmp_identifier]=array_merge((array)$data_post_stock[$tmp_identifier],array('COMPANY_CODE'=>$val));
			}elseif (preg_match('/WEIGHT/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom STOCK (kg) - OTHER STOCK pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_stock[$tmp_identifier]=array_merge((array)$data_post_stock[$tmp_identifier],array('WEIGHT'=>$val));	
				}				
			}elseif (preg_match('/FFA/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom FFA - OTHER STOCK pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_stock[$tmp_identifier]=array_merge((array)$data_post_stock[$tmp_identifier],array('FFA'=>$val));	
				}				
			}elseif (preg_match('/MOISTURE/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom MOISTURE-OTHER STOCK pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_stock[$tmp_identifier]=array_merge((array)$data_post_stock[$tmp_identifier],array('MOISTURE'=>$val));	
				}					
			}elseif (preg_match('/DIRT/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom DIRTY - OTHER STOCK pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_stock[$tmp_identifier]=array_merge((array)$data_post_stock[$tmp_identifier],array('DIRT'=>$val));	
				}				
			}
			$data_post_stock[$tmp_identifier]=array_merge((array)$data_post_stock[$tmp_identifier],array('ID_BA'=>$data_post['ID_BA']));				
		}	
		//end: stock
		//start: storage
		$data_post_storage = array();
		$int=0;
		$tmp_identifier=0;
		foreach($data_storage as $key => $val){			
			$int = filter_var($key, FILTER_SANITIZE_NUMBER_INT);			
            $tmp_identifier=$int;	
			if (preg_match('/STRG_STOCK_DATE/',$key)){
				$c = array('STRG_STOCK_DATE'=>$val);
				$data_post_storage[$tmp_identifier]=$c;
			}elseif (preg_match('/ID_STORAGE/',$key)){
				if($val==''){
                    $return['status']="Storage code pada baris ".$int." tidak boleh kosong   \r\n";
                    $return['error']=true;   
                }else{
					$data_post_storage[$tmp_identifier]=array_merge((array)$data_post_storage[$tmp_identifier],array('ID_STORAGE'=>$val));
				}
				
			}elseif (preg_match('/COMPANY_CODE/',$key)){
				$data_post_storage[$tmp_identifier]=array_merge((array)$data_post_storage[$tmp_identifier],array('COMPANY_CODE'=>$val));
			}elseif (preg_match('/WEIGHT/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom STOCK (kg) - STORAGE STOCK pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_storage[$tmp_identifier]=array_merge((array)$data_post_storage[$tmp_identifier],array('WEIGHT'=>$val));	
				}				
			}elseif (preg_match('/FFA/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom FFA - STORAGE STOCK pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_storage[$tmp_identifier]=array_merge((array)$data_post_storage[$tmp_identifier],array('FFA'=>$val));	
				}				
			}elseif (preg_match('/MOISTURE/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom MOISTURE - STORAGE STOCK pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_storage[$tmp_identifier]=array_merge((array)$data_post_storage[$tmp_identifier],array('MOISTURE'=>$val));	
				}					
			}elseif (preg_match('/DIRT/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom DIRTY - STORAGE STOCK pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_storage[$tmp_identifier]=array_merge((array)$data_post_storage[$tmp_identifier],array('DIRT'=>$val));	
				}				
			}
			$data_post_storage[$tmp_identifier]=array_merge((array)$data_post_storage[$tmp_identifier],array('ID_BA'=>$data_post['ID_BA']));				
		}
		//end: storage
		//start: performance
		$data_post['PROCESSED_HOUR']=strtoupper(trim(htmlentities($data_performance['PROCESSED_HOUR'],ENT_QUOTES,'UTF-8'))) ;
		$data_post['THROUGHPUT']=strtoupper(trim(htmlentities($data_performance['THROUGHPUT'],ENT_QUOTES,'UTF-8'))) ;
		$data_post['MILL_UTILIZATION']=strtoupper(trim(htmlentities($data_performance['MILL_UTILIZATION'],ENT_QUOTES,'UTF-8'))) ;
		
		$validate_numeric=$this->validate_numeric($data_post['PROCESSED_HOUR']);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai PROCESSED HOUR harus angka";
            $return['error']=true;        
        }
		
		$validate_numeric=$this->validate_numeric($data_post['THROUGHPUT']);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai THROUGHPUT harus angka";
            $return['error']=true;        
        }
		
		$validate_numeric=$this->validate_numeric($data_post['MILL_UTILIZATION']);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai MILL UTILIZATION harus angka";
            $return['error']=true;        
        }
		
		if(strlen($data_post['PROCESSED_HOUR']) > 50){
            $return['status']  ="Panjang karakter PROCESSED_HOUR melebihi batas maksimal";
            $return['error']=true;
        }
		
		if(strlen($data_post['THROUGHPUT']) > 50){
            $return['status']  ="Panjang karakter THROUGHPUT melebihi batas maksimal";
            $return['error']=true;
        }
		
		if(strlen($data_post['MILL_UTILIZATION']) > 50){
            $return['status']  ="Panjang karakter MILL_UTILIZATION melebihi batas maksimal";
            $return['error']=true;
        }
		//end: performance
				
		if(empty($return['status']) && $return['error']==false){     
            $insert_id = $this->model_s_input_ba->add_new($company,$data_post);
			
			if($insert_id['error'] == false){ 
            	$insert_detail = $this->model_s_input_ba->add_new_production($data_post['ID_BA'], $company, $data_post_d);
				$insert_detail = $this->model_s_input_ba->add_new_dispatch($data_post['ID_BA'], $company, $data_post_dispatch);
				$insert_detail = $this->model_s_input_ba->add_new_stock($data_post['ID_BA'], $company, $data_post_stock);
				$insert_detail = $this->model_s_input_ba->add_new_storage_stock($data_post['ID_BA'], $company, $data_post_storage);				
				$insert_detail = $this->model_s_input_ba->update_approval($data_post['QC'], $data_post['MILL_MANAGER'], $data_post['KTU'], $data_post['ADMINISTRATUR'], $data_post['LABOR'], $company);
				
				$message = $insert_detail;
			}else{
				$message = $insert_id;	
			}		

            echo json_encode($message);          
        }else{
            echo json_encode($return);
        }
		
    }
				
    function update_data($data_id, $data_prod, $data_dispatch, $data_stock, $data_storage, $data_performance){
        //Start for Master BA
        $return['status']='';
        $return['error']=FALSE;
        $company = trim(htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8'));
        
		$id_ba = strtoupper(trim(htmlentities($data_id['ID_BA'],ENT_QUOTES,'UTF-8')));
        $data_post['BA_DATE'] = strtoupper(trim(htmlentities($data_id['BA_DATE'],ENT_QUOTES,'UTF-8')));
        $data_post['QC']=strtoupper(trim(htmlentities($data_id['QC'],ENT_QUOTES,'UTF-8'))) ;
		$data_post['MILL_MANAGER']=strtoupper(trim(htmlentities($data_id['MILL_MANAGER'],ENT_QUOTES,'UTF-8'))) ;
		$data_post['KTU']=strtoupper(trim(htmlentities($data_id['KTU'],ENT_QUOTES,'UTF-8')));
		$data_post['ADMINISTRATUR']=strtoupper(trim(htmlentities($data_id['ADMINISTRATUR'],ENT_QUOTES,'UTF-8')));
		$data_post['LABOR']=strtoupper(trim(htmlentities($data_id['LABOR'],ENT_QUOTES,'UTF-8')));
		$data_post['DESCRIPTION']=strtoupper(trim(htmlentities($data_id['DESCRIPTION'],ENT_QUOTES,'UTF-8')));
        
		$data_post['FFB_INTI']=strtoupper(trim(htmlentities($data_id['FFB_INTI'],ENT_QUOTES,'UTF-8')));
		$data_post['FFB_PLASMA']=strtoupper(trim(htmlentities($data_id['FFB_PLASMA'],ENT_QUOTES,'UTF-8')));
		$data_post['FFB_SUPPLIER']=strtoupper(trim(htmlentities($data_id['FFB_SUPPLIER'],ENT_QUOTES,'UTF-8')));
		$data_post['FFB_GROUP']=strtoupper(trim(htmlentities($data_id['FFB_GROUP'],ENT_QUOTES,'UTF-8')));		
		$data_post['FFB_PROCESSED']=strtoupper(trim(htmlentities($data_id['FFB_PROCESSED'],ENT_QUOTES,'UTF-8')));
		$data_post['BALANCE_YESTERDAY']=strtoupper(trim(htmlentities($data_id['BALANCE_YESTERDAY'],ENT_QUOTES,'UTF-8')));
		$data_post['LORI_OLAH']=strtoupper(trim(htmlentities($data_id['LORI_OLAH'],ENT_QUOTES,'UTF-8')));
		$data_post['LORI_RESTAN']=strtoupper(trim(htmlentities($data_id['LORI_RESTAN'],ENT_QUOTES,'UTF-8')));
		$data_post['BALANCE']=(($data_post['FFB_INTI']+$data_post['FFB_PLASMA']+$data_post['FFB_SUPPLIER']+$data_post['FFB_GROUP']+$data_post['BALANCE_YESTERDAY'])-$data_post['FFB_PROCESSED']);
		$data_post['CAGE_WEIGHT']=strtoupper(trim(htmlentities($data_id['CAGE_WEIGHT'],ENT_QUOTES,'UTF-8')));
		
		$data_post['BUAH_MENTAH']=strtoupper(trim(htmlentities($data_id['BUAH_MENTAH'],ENT_QUOTES,'UTF-8')));
		$data_post['BUAH_BUSUK']=strtoupper(trim(htmlentities($data_id['BUAH_BUSUK'],ENT_QUOTES,'UTF-8')));
		$data_post['JJK']=strtoupper(trim(htmlentities($data_id['JJK'],ENT_QUOTES,'UTF-8')));
		$data_post['TANGKAI']=strtoupper(trim(htmlentities($data_id['TANGKAI'],ENT_QUOTES,'UTF-8')));
		$data_post['BRONDOLAN']=strtoupper(trim(htmlentities($data_id['BRONDOLAN'],ENT_QUOTES,'UTF-8')));
		$data_post['HOUR_FROM']=strtoupper(trim(htmlentities($data_id['HOUR_FROM'],ENT_QUOTES,'UTF-8')));
		$data_post['HOUR_TO']=strtoupper(trim(htmlentities($data_id['HOUR_TO'],ENT_QUOTES,'UTF-8')));
		$data_post['CBC_FROM']=strtoupper(trim(htmlentities($data_id['CBC_FROM'],ENT_QUOTES,'UTF-8')));
		$data_post['CBC_TO']=strtoupper(trim(htmlentities($data_id['CBC_TO'],ENT_QUOTES,'UTF-8')));
				
		$data_post['UPDATE_BY'] = trim(htmlentities($this->session->userdata('LOGINID'),ENT_QUOTES,'UTF-8'));
		$data_post['UPDATE_TIME'] =  $this->global_func->gen_datetime(); 
        $data_post['COMPANY_CODE'] = $company;
		
		$ba_date=strval($data_post['BA_DATE']);
        if(empty($ba_date) || $ba_date==null || $ba_date==false){
            $return['status']="Tanggal berita acara tidak boleh kosong";
            $return['error']=true;
        }else{ 
            if(date("Ymd",strtotime($ba_date)) == '19700101'){
                $return['status']="format tanggal salah";
                $return['error']=true;
            }
        }
		
		$field = $data_post['BUAH_MENTAH'];
		$validate_numeric=$this->validate_numeric($field);		
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai Buah mentah harus angka";
            $return['error']=true;        
        }
		
		$field = $data_post['BUAH_BUSUK'];
		$validate_numeric=$this->validate_numeric($field);		
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai Buah busuk harus angka";
            $return['error']=true;        
        }
		
		$field = $data_post['JJK'];
		$validate_numeric=$this->validate_numeric($field);		
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai JJK harus angka";
            $return['error']=true;        
        }
		
		$field = $data_post['BRONDOLAN'];
		$validate_numeric=$this->validate_numeric($field);		
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai brondolan harus angka";
            $return['error']=true;        
        }
		
		$field = $data_post['CBC_FROM'];
		$validate_numeric=$this->validate_numeric($field);		
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai CBC harus angka";
            $return['error']=true;        
        }
		
		$field = $data_post['CBC_TO'];
		$validate_numeric=$this->validate_numeric($field);		
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai CBC harus angka";
            $return['error']=true;        
        }
		
		$field = $data_post['TANGKAI'];
		$validate_numeric=$this->validate_numeric($field);		
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai panjang tangkai harus angka";
            $return['error']=true;        
        }
		
		$field = $data_post['FFB_INTI'];
		$validate_numeric=$this->validate_numeric($field);
		
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai FFB Inti harus angka";
            $return['error']=true;        
        }		
		if(strlen($data_post['FFB_INTI']) > 50){
            $return['status']  ="Panjang karakter FFB Inti melebihi batas maksimal";
            $return['error']=true;
        }
		
		$field = $data_post['FFB_PLASMA'];
		$validate_numeric=$this->validate_numeric($field);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai FFB Plasma harus angka";
            $return['error']=true;        
        }
		if(strlen($data_post['FFB_PLASMA']) > 50){
            $return['status']  ="Panjang karakter FFB plasma melebihi batas maksimal";
            $return['error']=true;
        }
		
		$field = $data_post['FFB_SUPPLIER'];
		$validate_numeric=$this->validate_numeric($field);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai FFB supplier harus angka";
            $return['error']=true;        
        }
		if(strlen($data_post['FFB_SUPPLIER']) > 50){
            $return['status']  ="Panjang karakter FFB supplier melebihi batas maksimal";
            $return['error']=true;
        }
		
		$field = $data_post['FFB_GROUP'];
		$validate_numeric=$this->validate_numeric($field);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai FFB group harus angka";
            $return['error']=true;        
        }
		if(strlen($data_post['FFB_GROUP']) > 50){
            $return['status']  ="Panjang karakter FFB group melebihi batas maksimal";
            $return['error']=true;
        }
		
		$field = $data_post['FFB_PROCESSED'];
		$validate_numeric=$this->validate_numeric($field);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai FFB processed harus angka";
            $return['error']=true;        
        }
		if(strlen($data_post['FFB_GROUP']) > 50){
            $return['status']  ="Panjang karakter FFB processed melebihi batas maksimal";
            $return['error']=true;
        }
		
		$field = $data_post['CAGE_WEIGHT'];
		$validate_numeric=$this->validate_numeric($field);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai cage weight harus angka";
            $return['error']=true;        
        }
		
		if(strlen($data_post['CAGE_WEIGHT']) > 50){
            $return['status']  ="Panjang karakter cage weight melebihi batas maksimal";
            $return['error']=true;
        }
		
		$field = $data_post['BALANCE_YESTERDAY'];
		$validate_numeric=$this->validate_numeric($field);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai balance yesterday harus angka";
            $return['error']=true;        
        }		
		if(strlen($data_post['BALANCE_YESTERDAY']) > 50){
            $return['status']  ="Panjang karakter balance yesterday melebihi batas maksimal";
            $return['error']=true;
        }
		
		$field = $data_post['LORI_OLAH'];
		$validate_numeric=$this->validate_numeric($field);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai lori olah harus angka";
            $return['error']=true;        
        }		
		if(strlen($data_post['LORI_OLAH']) > 50){
            $return['status']  ="Panjang karakter lori olah melebihi batas maksimal";
            $return['error']=true;
        }
		
		$field = $data_post['LORI_RESTAN'];
		$validate_numeric=$this->validate_numeric($field);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai lori restan harus angka";
            $return['error']=true;        
        }		
		if(strlen($data_post['LORI_RESTAN']) > 50){
            $return['status']  ="Panjang karakter lori restan melebihi batas maksimal";
            $return['error']=true;
        }
		
		//end for Master BA
		//start: production
		$data_post_d = array();		
		$int=0;
		$tmp_identifier=0;
		foreach($data_prod as $key => $val){			
			$int = filter_var($key, FILTER_SANITIZE_NUMBER_INT);			
            $tmp_identifier=$int;		
			if (preg_match('/PRODUCTION_DATE/',$key)){
				$a = array('PRODUCTION_DATE'=>$val);
				$data_post_d[$tmp_identifier]=$a;
			}elseif (preg_match('/ID_COMMODITY/',$key)){
				if($val==''){
                    $return['status']="PRODUCTION commodity code pada baris ".$int." tidak boleh kosong   \r\n";
                    $return['error']=true;   
                }else{
					$data_post_d[$tmp_identifier]=array_merge((array)$data_post_d[$tmp_identifier],array('ID_COMMODITY'=>$val));
				}
			}elseif (preg_match('/COMPANY_CODE/',$key)){
				$data_post_d[$tmp_identifier]=array_merge((array)$data_post_d[$tmp_identifier],array('COMPANY_CODE'=>$val));
			}elseif (preg_match('/WEIGHT/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom production pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_d[$tmp_identifier]=array_merge((array)$data_post_d[$tmp_identifier],array('WEIGHT'=>$val));	
				}
			}elseif (preg_match('/FFA/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom FFA PRODUCTION pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_d[$tmp_identifier]=array_merge((array)$data_post_d[$tmp_identifier],array('FFA'=>$val));	
				}				
			}elseif (preg_match('/MOISTURE/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom MOISTURE PRODUCTION pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_d[$tmp_identifier]=array_merge((array)$data_post_d[$tmp_identifier],array('MOISTURE'=>$val));	
				}					
			}elseif (preg_match('/DIRT/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom DIRTY PRODUCTION pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_d[$tmp_identifier]=array_merge((array)$data_post_d[$tmp_identifier],array('DIRT'=>$val));	
				}				
			}
			$data_post_d[$tmp_identifier]=array_merge((array)$data_post_d[$tmp_identifier],array('ID_BA'=>$id_ba));
			$data_post_d[$tmp_identifier]=array_merge((array)$data_post_d[$tmp_identifier],array('UPDATE_BY'=>trim(htmlentities($this->session->userdata('LOGINID'),ENT_QUOTES,'UTF-8'))
																																						 ));
			$data_post_d[$tmp_identifier]=array_merge((array)$data_post_d[$tmp_identifier],array('UPDATE_TIME'=>$this->global_func->gen_datetime()
																														   ));
		}
		//end: production

		//start: dispatch
		$data_post_dispatch = array();
		$int=0;
		$tmp_identifier=0;
		foreach($data_dispatch as $key => $val){			
			$int = filter_var($key, FILTER_SANITIZE_NUMBER_INT);			
            $tmp_identifier=$int;	
			if (preg_match('/DISPATCH_DATE/',$key)){
				$b = array('DISPATCH_DATE'=>$val);
				$data_post_dispatch[$tmp_identifier]=$b;
			}elseif (preg_match('/ID_COMMODITY/',$key)){
				if($val==''){
                    $return['status']="DISPATCH commodity code pada baris ".$int." tidak boleh kosong   \r\n";
                    $return['error']=true;   
                }else{
					$data_post_dispatch[$tmp_identifier]=array_merge((array)$data_post_dispatch[$tmp_identifier],array('ID_COMMODITY'=>$val));
				}
				
			}elseif (preg_match('/COMPANY_CODE/',$key)){
				$data_post_dispatch[$tmp_identifier]=array_merge((array)$data_post_dispatch[$tmp_identifier],array('COMPANY_CODE'=>$val));
			}elseif (preg_match('/WEIGHT/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom dispatch (kg) pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_dispatch[$tmp_identifier]=array_merge((array)$data_post_dispatch[$tmp_identifier],array('WEIGHT'=>$val));
				}				
			}elseif (preg_match('/FFA/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom FFA-dispatch pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_dispatch[$tmp_identifier]=array_merge((array)$data_post_dispatch[$tmp_identifier],array('FFA'=>$val));	
				}				
			}elseif (preg_match('/MOISTURE/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom MOISTURE-dispatch pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_dispatch[$tmp_identifier]=array_merge((array)$data_post_dispatch[$tmp_identifier],array('MOISTURE'=>$val));	
				}					
			}elseif (preg_match('/DIRT/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom DIRTY-dispatch pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_dispatch[$tmp_identifier]=array_merge((array)$data_post_dispatch[$tmp_identifier],array('DIRT'=>$val));	
				}				
			}
			$data_post_dispatch[$tmp_identifier]=array_merge((array)$data_post_dispatch[$tmp_identifier],array('ID_BA'=>$id_ba));	
			$data_post_dispatch[$tmp_identifier]=array_merge((array)$data_post_dispatch[$tmp_identifier],array('UPDATE_BY'=>trim(htmlentities($this->session->userdata('LOGINID'),ENT_QUOTES,'UTF-8'))
																																						 ));
			$data_post_dispatch[$tmp_identifier]=array_merge((array)$data_post_dispatch[$tmp_identifier],array('UPDATE_TIME'=>$this->global_func->gen_datetime()
																														   ));
		}	
		//end: dispatch
		//start: stock
		$data_post_stock = array();
		$int=0;
		$tmp_identifier=0;
		foreach($data_stock as $key => $val){			
			$int = filter_var($key, FILTER_SANITIZE_NUMBER_INT);			
            $tmp_identifier=$int;	
			if (preg_match('/STOCK_DATE/',$key)){
				$c = array('STOCK_DATE'=>$val);
				$data_post_stock[$tmp_identifier]=$c;
			}elseif (preg_match('/ID_COMMODITY/',$key)){
				if($val==''){
                    $return['status']="STOCK commodity code pada baris ".$int." tidak boleh kosong   \r\n";
                    $return['error']=true;   
                }else{
					$data_post_stock[$tmp_identifier]=array_merge((array)$data_post_stock[$tmp_identifier],array('ID_COMMODITY'=>$val));
				}
				
			}elseif (preg_match('/COMPANY_CODE/',$key)){
				$data_post_stock[$tmp_identifier]=array_merge((array)$data_post_stock[$tmp_identifier],array('COMPANY_CODE'=>$val));
			}elseif (preg_match('/WEIGHT/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom STOCK (kg)- OTHER STOCK  pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_stock[$tmp_identifier]=array_merge((array)$data_post_stock[$tmp_identifier],array('WEIGHT'=>$val));	
				}				
			}elseif (preg_match('/FFA/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom FFA-OTHER STOCK pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_stock[$tmp_identifier]=array_merge((array)$data_post_stock[$tmp_identifier],array('FFA'=>$val));	
				}				
			}elseif (preg_match('/MOISTURE/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom MOISTURE-OTHER STOCK pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_stock[$tmp_identifier]=array_merge((array)$data_post_stock[$tmp_identifier],array('MOISTURE'=>$val));	
				}					
			}elseif (preg_match('/DIRT/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom DIRTY-OTHER STOCK pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_stock[$tmp_identifier]=array_merge((array)$data_post_stock[$tmp_identifier],array('DIRT'=>$val));	
				}				
			}
			$data_post_stock[$tmp_identifier]=array_merge((array)$data_post_stock[$tmp_identifier],array('ID_BA'=>$id_ba));
			$data_post_stock[$tmp_identifier]=array_merge((array)$data_post_stock[$tmp_identifier],array('UPDATE_BY'=>trim(htmlentities($this->session->userdata('LOGINID'),ENT_QUOTES,'UTF-8'))
																																						 ));
			$data_post_stock[$tmp_identifier]=array_merge((array)$data_post_stock[$tmp_identifier],array('UPDATE_TIME'=>$this->global_func->gen_datetime()
																														   ));
		}	
		//end: stock
		//start: storage
		$data_post_storage = array();
		$int=0;
		$tmp_identifier=0;

		foreach($data_storage as $key => $val){			
			$int = filter_var($key, FILTER_SANITIZE_NUMBER_INT);			
            $tmp_identifier=$int;	
			if (preg_match('/STRG_STOCK_DATE/',$key)){
				$c = array('STRG_STOCK_DATE'=>$val);
				$data_post_storage[$tmp_identifier]=$c;
			}elseif (preg_match('/ID_STORAGE/',$key)){
				if($val==''){
                    $return['status']="Storage code pada baris ".$int." tidak boleh kosong   \r\n";
                    $return['error']=true;   
                }else{
					$data_post_storage[$tmp_identifier]=array_merge((array)$data_post_storage[$tmp_identifier],array('ID_STORAGE'=>$val));
				}
				
			}elseif (preg_match('/COMPANY_CODE/',$key)){
				$data_post_storage[$tmp_identifier]=array_merge((array)$data_post_storage[$tmp_identifier],array('COMPANY_CODE'=>$val));
			}elseif (preg_match('/WEIGHT/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom STOCK (kg) - STORAGE STOCK  pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_storage[$tmp_identifier]=array_merge((array)$data_post_storage[$tmp_identifier],array('WEIGHT'=>$val));	
				}				
			}elseif (preg_match('/FFA/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom FFA - STORAGE STOCK pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_storage[$tmp_identifier]=array_merge((array)$data_post_storage[$tmp_identifier],array('FFA'=>$val));	
				}				
			}elseif (preg_match('/MOISTURE/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom MOISTURE - STORAGE STOCK pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_storage[$tmp_identifier]=array_merge((array)$data_post_storage[$tmp_identifier],array('MOISTURE'=>$val));	
				}					
			}elseif (preg_match('/DIRT/',$key)){
				$field = $val;
				$validate_numeric=$this->validate_numeric($field);
        		if( strtolower($validate_numeric)=='false'){
            		$return['status'] ="Nilai kolom DIRTY - STORAGE STOCK pada baris ".$int." harus angka \r\n ";
            		$return['error']=true;        
				}else{
					$data_post_storage[$tmp_identifier]=array_merge((array)$data_post_storage[$tmp_identifier],array('DIRT'=>$val));	
				}				
			}
			$data_post_storage[$tmp_identifier]=array_merge((array)$data_post_storage[$tmp_identifier],array('ID_BA'=>$id_ba));		
			$data_post_storage[$tmp_identifier]=array_merge((array)$data_post_storage[$tmp_identifier],array('UPDATE_BY'=>trim(htmlentities($this->session->userdata('LOGINID'),ENT_QUOTES,'UTF-8'))
																																						 ));
			$data_post_storage[$tmp_identifier]=array_merge((array)$data_post_storage[$tmp_identifier],array('UPDATE_TIME'=>$this->global_func->gen_datetime()
																														   ));
		}
		//end: storage
		//start: performance
		$data_post['PROCESSED_HOUR']=strtoupper(trim(htmlentities($data_performance['PROCESSED_HOUR'],ENT_QUOTES,'UTF-8'))) ;
		$data_post['THROUGHPUT']=strtoupper(trim(htmlentities($data_performance['THROUGHPUT'],ENT_QUOTES,'UTF-8'))) ;
		$data_post['MILL_UTILIZATION']=strtoupper(trim(htmlentities($data_performance['MILL_UTILIZATION'],ENT_QUOTES,'UTF-8'))) ;
		
		$validate_numeric=$this->validate_numeric($data_post['PROCESSED_HOUR']);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai PROCESSED HOUR harus angka";
            $return['error']=true;        
        }
		
		$validate_numeric=$this->validate_numeric($data_post['THROUGHPUT']);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai THROUGHPUT harus angka";
            $return['error']=true;        
        }
		
		$validate_numeric=$this->validate_numeric($data_post['MILL_UTILIZATION']);
        if( strtolower($validate_numeric)=='false'){
            $return['status'] ="Nilai MILL UTILIZATION harus angka";
            $return['error']=true;        
        }
		
		if(strlen($data_post['PROCESSED_HOUR']) > 50){
            $return['status']  ="Panjang karakter PROCESSED_HOUR melebihi batas maksimal";
            $return['error']=true;
        }
		
		if(strlen($data_post['THROUGHPUT']) > 50){
            $return['status']  ="Panjang karakter THROUGHPUT melebihi batas maksimal";
            $return['error']=true;
        }
		
		if(strlen($data_post['MILL_UTILIZATION']) > 50){
            $return['status']  ="Panjang karakter MILL_UTILIZATION melebihi batas maksimal";
            $return['error']=true;
        }
		//end: performance
		
		if(empty($return['status']) && $return['error']==false){  
			$update_id = $this->model_s_input_ba->update_data($id_ba, $company, $data_post);			
			if($update_id['error'] == false){ 
            	$insert_detail = $this->model_s_input_ba->update_production($id_ba, $company, $data_post_d);
				$insert_detail = $this->model_s_input_ba->update_dispatch($id_ba, $company, $data_post_dispatch);
				$insert_detail = $this->model_s_input_ba->update_stock($id_ba, $company, $data_post_stock);
				$insert_detail = $this->model_s_input_ba->update_storage_stock($id_ba, $company, $data_post_storage);				
				$insert_detail = $this->model_s_input_ba->update_approval($data_post['QC'], $data_post['MILL_MANAGER'], $data_post['KTU'], $data_post['ADMINISTRATUR'], $data_post['LABOR'], $company);
				
				$message = $insert_detail;
			}else{
				$message = $insert_id;	
			}		
            echo json_encode($message);          
        }else{
            echo json_encode($return);
        }
    }
	
    function delete_data($data_id){
        $return['status']="";
        $return['error']=false;
        
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');
        $id_ba = strtoupper(trim(htmlentities($data_id['ID_BA'],ENT_QUOTES,'UTF-8'))) ;    
        if (empty($id_ba) || trim($id_ba)=='' || $id_ba==false){
            $return['status']="ID BA KOSONG";
            $return['error']=true;   
        }
        
        if(empty($return['status']) && $return['error']==false){     
            $delete_id = $this->model_s_input_ba->delete_ba($id_ba,$company);
            $return['status']=  $delete_id;
            $return['error']=false;
            echo json_encode($return);
                      
        }else{
            echo json_encode($return);
        }
        
    }
	
	function approve_data($data_id){
        $return['status']="";
        $return['error']=false;
        
        $company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');
        $id_ba = strtoupper(trim(htmlentities($data_id['ID_BA'],ENT_QUOTES,'UTF-8'))) ; 
		$ba_date = strtoupper(trim(htmlentities($data_id['BA_DATE'],ENT_QUOTES,'UTF-8'))) ;
        if (empty($id_ba) || trim($id_ba)=='' || $id_ba==false){
            $return['status']="ID BA KOSONG";
            $return['error']=true;   
        }
        if (empty($ba_date) || trim($ba_date)=='' || $ba_date==false){
            $return['status']="BA DATE KOSONG";
            $return['error']=true;   
        }
        if(empty($return['status']) && $return['error']==false){     
            $delete_id = $this->model_s_input_ba->approve_ba($id_ba,$company,$ba_date);
            $return['status']=  $delete_id;
            $return['error']=false;
            echo json_encode($return);
                      
        }else{
            echo json_encode($return);
        }
        
    }

	function validate_approve($dates){
		$company = htmlentities($this->session->userdata('DCOMPANY'),ENT_QUOTES,'UTF-8');
		$status_ba=$this->model_s_input_ba->get_ba($company, $dates);
		return $status_ba;
	}

    function validate_numeric($data){
        $numeric=$data;
        $result='';
        if(is_array($data)){
            while(list($key,$val)=each($data)){
                if(trim($val)=="" || $val==null){
                    $val=0;
                }
                if((! preg_match('/(^-*\d+$)|(^-*\d+\.\d+$)/',$val))){
                    $result='false';
                    break;
                }else{
                    $result='true';   
                }
            }
        }else {
            if(trim($numeric)=="" || $numeric == null){
                $numeric=0;
            }
            if (! preg_match('/(^-*\d+$)|(^-*\d+\.\d+$)/',$numeric)){
                $result='false';   
            }else{
                $result='true';
            }    
        }

        return $result;   
    }
		
}
?>

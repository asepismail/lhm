<?class global_func{	    var $obj;  	function global_func(){	       $this->obj = &get_instance();	}		//################ 31 Jan 2011 #######################    //####################################################    function cek_user_authentification($u_level,$act){        $u_level = trim($this->obj->db->escape_str($u_level));        $act = strtoupper(trim($act));                $query = "SELECT ROLE_ADD, ROLE_EDIT, ROLE_DELETE, ROLE_REPORT                    FROM m_user_grole                     WHERE USER_GROUP_ID='".$u_level."'";        $sQuery = $this->obj->db->query($query);        $rowcount=$sQuery->num_rows();                $temp_result = array();        if(!empty($rowcount)){            foreach ( $sQuery->result_array() as $row )            {                $temp_result[] = $row;            }        }        return $temp_result;        }        function createID_Nota($namaTable,$namaPK,$begID,$company)    {         $day = date('d');        $month = date('m');        $year = date('y');        $date = $year.$month.$day;        $this->obj->db->select_max($namaPK);        $this->obj->db->from($namaTable);        $temp= $this->obj->db->get();        $this->obj->db->close();        $temp = $temp->result_array();        $hasil = $begID.$date;                if(empty($temp[0][$namaPK]))        {            $hasil = $hasil."0001";        }                else        {            $str = $temp[0][$namaPK];            $str = substr($str,strlen($company)+9,strlen($company)+12);            $str = $str+1;                        $panjangString = 4;            $jumlahNol = $panjangString - strlen($str);                        for($i =0;$i<$jumlahNol;$i++)            {                $hasil .= "0";            }                        $hasil .= $str;        }                return $hasil;    }        function createMy_ID($namaTable,$namaPK,$begID){        $day = date('d');        $month = date('m');        $year = date('y');        $date = $year.$month.$day;        $this->obj->db->select_max($namaPK);        $this->obj->db->from($namaTable);        $temp= $this->obj->db->get();        $this->obj->db->close();        $temp = $temp->result_array();        $hasil = $begID.$date;        $len_awalan='';                if(empty($temp[0][$namaPK]))        {            $hasil = $hasil."0001";        }                else        {            $len_awalan = strlen($begID.$date);            $str = $temp[0][$namaPK];            $str = substr($str,$len_awalan,$len_awalan+3);             $str = $str+1;            $panjangString = 4;            $jumlahNol = $panjangString - strlen($str);                        for($i =0;$i<$jumlahNol;$i++)            {                $hasil .= "0";            }                        $hasil .= $str;        }       $final_fixID = $this->cek_id_exist($namaTable,$namaPK,$hasil,$len_awalan);       return $final_fixID;//substr($temp[0][$namaPK],$len_awalan,$len_awalan+3);    }        private function cek_id_exist($namaTable,$namaPK,$ID,$len_awalan){        $query = "SELECT ".trim($namaPK)." FROM ".$namaTable." WHERE ".trim($namaPK)."='".$ID."' ";        $sQuery = $this->obj->db->query($query);        $row = $sQuery->row_array();        //$tmp_id=$row[trim($namaPK)]; //LIHTBG1102010001                $count = $sQuery->num_rows();        $fix_id ='';        $pattern=substr($ID,0,$len_awalan);        if($count>0){// if id exist, then regenerate it            $str = $ID;//LIHTBG1102010001            while ($fix_id==''){                $hasil=$pattern;                $str = substr($str,$len_awalan,$len_awalan+3);                 $str = $str+1;                $panjangString = 4;                $jumlahNol = $panjangString - strlen($str);                                for($i =0;$i<$jumlahNol;$i++)                {                    $hasil .= "0";                }                 $hasil .= $str;                                $query = "SELECT ".$namaPK." FROM ".$namaTable." WHERE ".$namaPK."='".$hasil."' ";                $sQuery = $this->obj->db->query($query);                $row = $sQuery->row_array();                                $count = $sQuery->num_rows();                if($count<=0){                    $fix_id =$hasil;                 }                 $str = $hasil;            }           }else{            $fix_id=$ID;            }        return $fix_id;         }        function gen_datetime(){        $time = 'DATETIME';        $time = str_replace(                array('DATETIME','DATE','TIME','YEAR'),                array('DATE TIME','Y-m-d','H:i:s','Y'),                $time            );        return date($time,time());    }    //####################################################    //####################################################    	function createID($namaTable,$namaPK,$begID)	{						$day = date('d');		$month = date('m');		$year = date('y');		$date = $year.$month.$day;								$this->obj->db->select_max($namaPK);		$this->obj->db->from($namaTable);		$temp= $this->obj->db->get();		$this->obj->db->close();		$temp = $temp->result_array();		$hasil = $begID.$date;						if(empty($temp[0][$namaPK]))		{			$hasil = $hasil."0001";		}				else		{			$str = $temp[0][$namaPK];			$str = substr($str,9,12);			$str = $str+1;						$panjangString = 4;			$jumlahNol = $panjangString - strlen($str);						for($i =0;$i<$jumlahNol;$i++)			{				$hasil .= "0";			}						$hasil .= $str;		}				return $hasil;	}			function id_GAD($namaTable,$namaPK,$begID)	{				$hasil = $begID;				$this->obj->db->select_max($namaPK);		$this->obj->db->like($namaPK, $hasil, 'after'); 		$this->obj->db->from($namaTable);		$temp= $this->obj->db->get();		$this->obj->db->close();		$temp = $temp->result_array();								if(empty($temp[0][$namaPK]))		{			$hasil = $hasil."0001";		}				else		{			$str = $temp[0][$namaPK];			$length = strlen($str) - 4;			$str = substr($str,$length,strlen($str));			$str = $str+1;									$panjangString = 4;			$jumlahNol = $panjangString - strlen($str);						for($i =0;$i<$jumlahNol;$i++)			{				$hasil .= "0";			}						$hasil .= $str;		}				return $hasil;	}			function id_BK($namaTable,$namaPK,$begID)	{						$day = date('d');		$month = date('m');		$year = date('y');		$date = $year.$month.$day;				$hasil = $begID.$date;				$this->obj->db->select_max($namaPK);		$this->obj->db->like($namaPK, $hasil, 'after'); 		$this->obj->db->from($namaTable);				$temp= $this->obj->db->get();		$this->obj->db->close();		$temp = $temp->result_array();							if(empty($temp[0][$namaPK]))		{			$hasil = $hasil."0001";		}				else		{			$str = $temp[0][$namaPK];			$length = strlen($str) - 4;			$str = substr($str,$length,strlen($str));			$str = $str+1;						$panjangString = 4;			$jumlahNol = $panjangString - strlen($str);						for($i =0;$i<$jumlahNol;$i++)			{				$hasil .= "0";			}						$hasil .= $str;		}				return $hasil;	}		function createID_vehicle($namaTable,$namaPK,$begID)	{						$day = date('d');		$month = date('m');		$year = date('y');		$date = $year.$month.$day;								$this->obj->db->select_max($namaPK);		$this->obj->db->from($namaTable);		$temp= $this->obj->db->get();		$this->obj->db->close();		$temp = $temp->result_array();		$hasil = $begID.$date;						if(empty($temp[0][$namaPK]))		{			$hasil = $hasil."0001";		}				else		{			$str = $temp[0][$namaPK];			$str = substr($str,9,12);			$str = $str+1;						$panjangString = 4;			$jumlahNol = $panjangString - strlen($str);						for($i =0;$i<$jumlahNol;$i++)			{				$hasil .= "0";			}						$hasil .= $str;		}				return $hasil;	}	function createTicketID($namaTable,$namaPK,$begID)	{				$day = date('d');		$month = date('m');		$year = date('y');		$date = $year.$month;				$this->obj->db->select_max($namaPK);		$this->obj->db->from($namaTable);		$temp= $this->obj->db->get();		$this->obj->db->close();		$temp = $temp->result_array();		$hasil = $begID.$date;						if(empty($temp[0][$namaPK]))		{			$hasil = $hasil."0001";		}				else		{			$str_c = $temp[0][$namaPK];			$str = substr($str_c,9,12);			$str = $str+1;						$panjangString = 4; 			$jumlahNol = $panjangString - strlen($str);						for($i =0;$i<$jumlahNol;$i++)			{				$hasil .=  "0";			}						$hasil .= $str;		}				return $hasil;	}		function createProjID($namaTable,$namaPK,$begID)	{						$day = date('d');		$month = date('m');		$year = date('y');		$date = $day.$month.$year;						$this->obj->db->select_max($namaPK);		$this->obj->db->from($namaTable);		$temp= $this->obj->db->get();		$this->obj->db->close();		$temp = $temp->result_array();		$hasil = $begID.$date;				if(empty($temp[0][$namaPK]))		{			$hasil = $hasil."01";		}				else		{			$str = $temp[0][$namaPK];			$str = substr($str,5,14);			$str = $str+1;						$panjangString = 5;			$jumlahNol = $panjangString - strlen($str);						for($i =0;$i<$jumlahNol;$i++)			{				$hasil .= "0";			}						$hasil = $begID.$str;		}				return $hasil;	}		function dropdownlist($nama_dropdown=null, $nama_tabel=null, $nama_tampil=null, $nama_isi=null, $column=null, $isi_column=null, $class=null, $default= null, $width=null, $onchange=null, $kolomOrder=null, $tabindex=null, $usingNull=null)	{			$this->obj->db->select('*');		$this->obj->db->from($nama_tabel);		if(!empty($column))		{			$this->obj->db->where($column, $isi_column);		}		if(!empty($kolomOrder))		{			$this->obj->db->order_by($kolomOrder, 'asc');		}		else		{									$this->obj->db->order_by($nama_tampil, 'asc');		}		 		$temp=$this->obj->db->get();		$temp = $temp->result_array();		$this->obj->db->close();		$string = "<select  name=\"".$nama_dropdown."\" class=\"".$class."\"  id=\"".$nama_dropdown."\" tabindex='".$tabindex."' ";		$string .= "<option value=''> -- choose -- </option>";		if(!empty($onchange))		{			$string = $string." onchange=\"". $onchange."\" ";		}		if(isset($width))		{			$string = $string." style=\"width:". $width."px\" ";		}		$string = $string." >";		if(isset($usingNull) && !(isset($default)))		{			$string = $string."<option selected></option>";		}		else if(isset($usingNull) && (isset($default)))		{			$string = $string."<option></option>";		}		foreach ( $temp as $row)		{			if( (isset($default)) && ($default==$row[$nama_isi]) )			{				$string = $string." <option value=\"".$row[$nama_isi]."\"  selected>".$row[$nama_tampil]." </option>";			}			else			{				$string = $string." <option value=\"".$row[$nama_isi]."\">".$row[$nama_tampil]." </option>";			}		}				$string =$string. "</select>";		return $string;	}			function dropdownlist2($nama_dropdown=null, $nama_tabel=null, $nama_tampil=null, $nama_isi=null, $where=null, $default= null, $width=null, $onchange=null,$class=null, $allcoll=null, $kolomOrder=null, $tabindex=null, $usingNull=null)	{			$this->obj->db->select('*');		$this->obj->db->from($nama_tabel);		if(!empty($where))		{			$this->obj->db->where($where);		}		if(!empty($kolomOrder))		{			$this->obj->db->order_by($kolomOrder, 'asc');		}		else		{									$this->obj->db->order_by($nama_tampil, 'asc');		}		 		$temp=$this->obj->db->get();		$temp = $temp->result_array();		$this->obj->db->close();		$string = "<select  name=\"".$nama_dropdown."\"  id=\"".$nama_dropdown."\" class='".$class."' tabindex='".$tabindex."' ";				if(!empty($onchange))		{			$string = $string." onchange=\"". $onchange."\" ";		}		if(isset($width))		{			$string = $string." style=\"width:". $width."px\" ";		}		$string = $string." >";		$string .= "<option value=''> -- pilih -- </option>";		if(isset($allcoll)){			if ($allcoll = true){				$string .= "<option value='all'> SEMUA </option>";			}		}				if(isset($usingNull) && !(isset($default)))		{			$string = $string."<option selected></option>";		}		else if(isset($usingNull) && (isset($default)))		{			$string = $string."<option></option>";		}		foreach ( $temp as $row)		{			if( (isset($default)) && ($default==$row[$nama_isi]) )			{				$string = $string." <option value=\"".$row[$nama_isi]."\"  selected>".$row[$nama_tampil]." </option>";			}			else			{				$string = $string." <option value=\"".$row[$nama_isi]."\">".$row[$nama_tampil]." </option>";			}		}				$string =$string. "</select>";		return $string;	}		function drop_date2($nmonth, $nyear,$class, $useDate=0)	{			$monthName = array(1=> "Januari", "Februari", "Maret",             "April", "Mei", "Juni", "Juli", "Agustus",             "September", "Oktober", "November", "Desember");          if($useDate == 0)         {             $useDate = time();         }  				$bulan = "";		$tahun = "";		        $bulan .= "<SELECT NAME=" . $nmonth . " style='width:100px;' class = ". $class ." id=" . $nmonth . ">\n";         for($currentMonth = 1; $currentMonth <= 12; $currentMonth++)         { 			            $bulan .= "<OPTION VALUE=\"";             if (strlen($currentMonth) < '2')			{			$currentMonths = "0".$currentMonth;			} else {			$currentMonths = $currentMonth;				}			$bulan .= $currentMonths;             $bulan .= "\"";             IF(intval(DATE( "m", $useDate))==$currentMonth)             {                 $bulan .= " SELECTED";             }             $bulan .= ">" . $monthName[$currentMonth] . "\n";         }         $bulan .= "</SELECT>";          $tahun .= "<SELECT NAME=" . $nyear . " style='width:70px;' class=".$class." id=" . $nyear . ">\n";         $startYear = date( "Y", $useDate);         for($currentYear = $startYear - 5; $currentYear <= $startYear+5;$currentYear++)         {             $tahun .= "<OPTION VALUE=\"$currentYear\"";             if(date( "Y", $useDate)==$currentYear)             {                 $tahun .= " SELECTED";             }             $tahun .= ">$currentYear\n";         }         $tahun .= "</SELECT>"; 				return $bulan."&nbsp;".$tahun;	}			function drop_date($nmonth, $nyear, $useDate=0)	{			$monthName = array(1=> "Januari", "Februari", "Maret",             "April", "Mei", "Juni", "Juli", "Agustus",             "September", "Oktober", "November", "Desember");          if($useDate == 0)         {             $useDate = time();         }  				$bulan = "";		$tahun = "";		        $bulan .= "<SELECT NAME=" . $nmonth . " id=" . $nmonth . ">\n";         for($currentMonth = 1; $currentMonth <= 12; $currentMonth++)         { 			            $bulan .= "<OPTION VALUE=\"";             if (strlen($currentMonth) < '2')			{			$currentMonths = "0".$currentMonth;			} else {			$currentMonths = $currentMonth;				}			$bulan .= $currentMonths;             $bulan .= "\"";             IF(intval(DATE( "m", $useDate))==$currentMonth)             {                 $bulan .= " SELECTED";             }             $bulan .= ">" . $monthName[$currentMonth] . "\n";         }         $bulan .= "</SELECT>";          $tahun .= "<SELECT NAME=" . $nyear . " id=" . $nyear . ">\n";         $startYear = date( "Y", $useDate);         for($currentYear = $startYear - 5; $currentYear <= $startYear+5;$currentYear++)         {             $tahun .= "<OPTION VALUE=\"$currentYear\"";             if(date( "Y", $useDate)==$currentYear)             {                 $tahun .= " SELECTED";             }             $tahun .= ">$currentYear\n";         }         $tahun .= "</SELECT>"; 				return $bulan."&nbsp;".$tahun;	} 			function dateDiff($interval,$dateTimeBegin,$dateTimeEnd) {		//Parse about any English textual datetime		//$dateTimeBegin, $dateTimeEnd				$dateTimeBegin=strtotime($dateTimeBegin);		if($dateTimeBegin === -1) {		return("..begin date Invalid");		}				$dateTimeEnd=strtotime($dateTimeEnd);		if($dateTimeEnd === -1) {		return("..end date Invalid");		}				$dif=$dateTimeEnd - $dateTimeBegin;				switch($interval) {		case "s"://seconds		return($dif);				case "n"://minutes		return(floor($dif/60)); //60s=1m				case "h"://hours		return(floor($dif/3600)); //3600s=1h				case "d"://days		return(floor($dif/86400)); //86400s=1d				case "ww"://Week		return(floor($dif/604800)); //604800s=1week=1semana				case "m": //similar result "m" dateDiff Microsoft		$monthBegin=(date("Y",$dateTimeBegin)*12)+		date("n",$dateTimeBegin);		$monthEnd=(date("Y",$dateTimeEnd)*12)+		date("n",$dateTimeEnd);		$monthDiff=$monthEnd-$monthBegin;		return($monthDiff);				case "yyyy": //similar result "yyyy" dateDiff Microsoft		return(date("Y",$dateTimeEnd) - date("Y",$dateTimeBegin));				default:		return(floor($dif/86400)); //86400s=1d		}		}}?>